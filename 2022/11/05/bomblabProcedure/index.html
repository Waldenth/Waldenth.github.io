<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.1.1" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.1.1" type="image/png" sizes="32x32"><meta name="description" content="Bomb Lab Procedure        This is an x86-64 bomb for self-study students. ATTENTION: if gdb says its authority  not enough, sudo su chmod 777 bomb                     准备工作        首">
<meta property="og:type" content="article">
<meta property="og:title" content="CSAPP Bomb Lab">
<meta property="og:url" content="https://www.neptunia.top/2022/11/05/bomblabProcedure/index.html">
<meta property="og:site_name" content="Aaron的个人空间">
<meta property="og:description" content="Bomb Lab Procedure        This is an x86-64 bomb for self-study students. ATTENTION: if gdb says its authority  not enough, sudo su chmod 777 bomb                     准备工作        首">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-11-05T04:18:03.018Z">
<meta property="article:modified_time" content="2020-11-08T13:23:11.093Z">
<meta property="article:author" content="Aaron">
<meta property="article:tag" content="计算机组成原理">
<meta name="twitter:card" content="summary"><title>CSAPP Bomb Lab | Aaron的个人空间</title><link ref="canonical" href="https://www.neptunia.top/2022/11/05/bomblabProcedure/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.1.1"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"复制","copySuccess":"复制成功","copyError":"复制失败"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.2.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">归档</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">标签</span></a></div></div><div class="header-nav-search"><span class="header-nav-search__icon"><i class="fas fa-search"></i></span><span class="header-nav-search__text">搜索</span></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">Aaron的个人空间</div><div class="header-banner-info__subtitle">Welcome</div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">CSAPP Bomb Lab</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2022-11-05</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2020-11-08</span></span><span class="post-meta-item post-meta-item--visitors"><span class="post-meta-item__icon"><i class="fas fa-eye"></i></span><span class="post-meta-item__info">阅读次数</span><span class="post-meta-item__value" id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body">
        <h2 id="bomb-lab-procedure"   >
          <a href="#bomb-lab-procedure" class="heading-link"><i class="fas fa-link"></i></a>Bomb Lab Procedure</h2>
      
<p>This is an x86-64 bomb for self-study students.</p>
<p><strong>ATTENTION:</strong><br />
if <code>gdb</code> says its authority  not enough,<br />
<code>sudo su</code><br />
<code>chmod 777 bomb</code></p>

        <h4 id="准备工作"   >
          <a href="#准备工作" class="heading-link"><i class="fas fa-link"></i></a>准备工作</h4>
      
<p>首先使用<code>Linux objdump</code>工具反汇编保存bomb二进制文件的反汇编代码bomb.asm</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objdump -d bomb &gt; bomb.asm</span><br></pre></td></tr></table></div></figure>
<p>再开启<code>gdb</code>调试bomb二进制文件</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb bomb</span><br></pre></td></tr></table></div></figure>
<p><strong>注意</strong></p>
<p><code>gdb run</code>可能会提示权限不够，要修改成可读可写可执行，输入命令</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo su;</span><br><span class="line">chomd 777 bomb</span><br></pre></td></tr></table></div></figure>

        <h4 id="查看代码"   >
          <a href="#查看代码" class="heading-link"><i class="fas fa-link"></i></a>查看代码</h4>
      

        <h5 id="c-代码"   >
          <a href="#c-代码" class="heading-link"><i class="fas fa-link"></i></a>C 代码</h5>
      
<p>首先查看<code>.c</code>代码，由于缺少头文件和其他文件，只能查看<code>bomb</code>的整体逻辑</p>
<p>这一段起始代码是尝试进行读文件操作，大概意识是拆除炸弹可以把所有的炸弹密钥字符串写入一个文档，然后将路径作为参数传递给<code>bomb</code>启动执行，如果没有传递参数，那么炸弹密钥通过命令行读取</p>
<figure class="highlight c"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *input; <span class="comment">//源代码38行</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Note to self: remember to port this bomb to Windows and put a </span></span><br><span class="line"><span class="comment">     * fantastic GUI on it. */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* When run with no arguments, the bomb reads its input lines </span></span><br><span class="line"><span class="comment">     * from standard input. */</span></span><br><span class="line">    <span class="keyword">if</span> (argc == <span class="number">1</span>) &#123;  </span><br><span class="line">	infile = <span class="built_in">stdin</span>;</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="comment">/* When run with one argument &lt;file&gt;, the bomb reads from &lt;file&gt; </span></span><br><span class="line"><span class="comment">     * until EOF, and then switches to standard input. Thus, as you </span></span><br><span class="line"><span class="comment">     * defuse each phase, you can add its defusing string to &lt;file&gt; and</span></span><br><span class="line"><span class="comment">     * avoid having to retype it. */</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (argc == <span class="number">2</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> (!(infile = fopen(argv[<span class="number">1</span>], <span class="string">&quot;r&quot;</span>))) &#123;</span><br><span class="line">	    <span class="built_in">printf</span>(<span class="string">&quot;%s: Error: Couldn&#x27;t open %s\n&quot;</span>, argv[<span class="number">0</span>], argv[<span class="number">1</span>]);</span><br><span class="line">	    <span class="built_in">exit</span>(<span class="number">8</span>);</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* You can&#x27;t call the bomb with more than 1 command line argument. */</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Usage: %s [&lt;input_file&gt;]\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">8</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>
<p>下面这一段是初始化炸弹<code>initialize_bomb();</code>想必是一个初始化函数，然后打印开始提示信息</p>
<figure class="highlight c"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Do all sorts of secret stuff that makes the bomb harder to defuse. */</span> <span class="comment">//66行</span></span><br><span class="line">    initialize_bomb();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Welcome to my fiendish little bomb. You have 6 phases with\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;which to blow yourself up. Have a nice day!\n&quot;</span>);</span><br></pre></td></tr></table></div></figure>
<p>主体部分，程序分为6个phase，每一个都需要你输入一行字符串，然后对应调用phase_n()函数进行判断是否触发炸弹</p>
<figure class="highlight c"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Hmm...  Six phases must be more secure than one phase! */</span>  <span class="comment">//72</span></span><br><span class="line">    input = read_line();             <span class="comment">/* Get input                   */</span></span><br><span class="line">    phase_1(input);                  <span class="comment">/* Run the phase               */</span></span><br><span class="line">    phase_defused();                 <span class="comment">/* Drat!  They figured it out!</span></span><br><span class="line"><span class="comment">				      * Let me know how they did it. */</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Phase 1 defused. How about the next one?\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* The second phase is harder.  No one will ever figure out</span></span><br><span class="line"><span class="comment">     * how to defuse this... */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_2(input);</span><br><span class="line">    phase_defused();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;That&#x27;s number 2.  Keep going!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* I guess this is too easy so far.  Some more complex code will</span></span><br><span class="line"><span class="comment">     * confuse people. */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_3(input);</span><br><span class="line">    phase_defused();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Halfway there!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Oh yeah?  Well, how good is your math?  Try on this saucy problem! */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_4(input);</span><br><span class="line">    phase_defused();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;So you got that one.  Try this one.\n&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* Round and &#x27;round in memory we go, where we stop, the bomb blows! */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_5(input);</span><br><span class="line">    phase_defused();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Good work!  On to the next...\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* This phase will never be used, since no one will get past the</span></span><br><span class="line"><span class="comment">     * earlier ones.  But just in case, make this one extra hard. */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_6(input);</span><br><span class="line">    phase_defused();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Wow, they got it!  But isn&#x27;t something... missing?  Perhaps</span></span><br><span class="line"><span class="comment">     * something they overlooked?  Mua ha ha ha ha! */</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></div></figure>

        <h5 id="反汇编代码"   >
          <a href="#反汇编代码" class="heading-link"><i class="fas fa-link"></i></a>反汇编代码</h5>
      
<p>先定位到main</p>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">0000000000400da0 &lt;main&gt;:</span><br><span class="line">  400da0:	53                   	push   %rbx</span><br><span class="line">  400da1:	83 ff 01             	cmp    $0x1,%edi</span><br><span class="line">  400da4:	75 10                	jne    400db6 &lt;main+0x16&gt;</span><br><span class="line">  400da6:	48 8b 05 9b 29 20 00 	mov    0x20299b(%rip),%rax        # 603748 &lt;stdin@@GLIBC_2.2.5&gt;</span><br><span class="line">  400dad:	48 89 05 b4 29 20 00 	mov    %rax,0x2029b4(%rip)        # 603768 &lt;infile&gt;</span><br><span class="line">  400db4:	eb 63                	jmp    400e19 &lt;main+0x79&gt;</span><br><span class="line">  400db6:	48 89 f3             	mov    %rsi,%rbx</span><br><span class="line">  400db9:	83 ff 02             	cmp    $0x2,%edi</span><br><span class="line">  400dbc:	75 3a                	jne    400df8 &lt;main+0x58&gt;</span><br><span class="line">  400dbe:	48 8b 7e 08          	mov    0x8(%rsi),%rdi</span><br><span class="line">  400dc2:	be b4 22 40 00       	mov    $0x4022b4,%esi</span><br><span class="line">  400dc7:	e8 44 fe ff ff       	callq  400c10 &lt;fopen@plt&gt;</span><br><span class="line">  400dcc:	48 89 05 95 29 20 00 	mov    %rax,0x202995(%rip)        # 603768 &lt;infile&gt;</span><br><span class="line">  400dd3:	48 85 c0             	test   %rax,%rax</span><br><span class="line">  400dd6:	75 41                	jne    400e19 &lt;main+0x79&gt;</span><br><span class="line">  400dd8:	48 8b 4b 08          	mov    0x8(%rbx),%rcx</span><br><span class="line">  400ddc:	48 8b 13             	mov    (%rbx),%rdx</span><br><span class="line">  400ddf:	be b6 22 40 00       	mov    $0x4022b6,%esi</span><br><span class="line">  400de4:	bf 01 00 00 00       	mov    $0x1,%edi</span><br><span class="line">  400de9:	e8 12 fe ff ff       	callq  400c00 &lt;__printf_chk@plt&gt;</span><br><span class="line">  400dee:	bf 08 00 00 00       	mov    $0x8,%edi</span><br><span class="line">  400df3:	e8 28 fe ff ff       	callq  400c20 &lt;exit@plt&gt;</span><br><span class="line">  400df8:	48 8b 16             	mov    (%rsi),%rdx</span><br><span class="line">  400dfb:	be d3 22 40 00       	mov    $0x4022d3,%esi</span><br><span class="line">  400e00:	bf 01 00 00 00       	mov    $0x1,%edi</span><br><span class="line">  400e05:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  400e0a:	e8 f1 fd ff ff       	callq  400c00 &lt;__printf_chk@plt&gt;</span><br><span class="line">  400e0f:	bf 08 00 00 00       	mov    $0x8,%edi</span><br><span class="line">  400e14:	e8 07 fe ff ff       	callq  400c20 &lt;exit@plt&gt;</span><br><span class="line">  400e19:	e8 84 05 00 00       	callq  4013a2 &lt;initialize_bomb&gt;;初始化炸弹</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  ;gdb调试信息：</span><br><span class="line">  ;(gdb) print (char*)(0x402338)</span><br><span class="line">  ;$1 &#x3D; 0x402338 &quot;Welcome to my fiendish little bomb. You have 6 phases with&quot;</span><br><span class="line">  400e1e:	bf 38 23 40 00       	mov    $0x402338,%edi</span><br><span class="line">  400e23:	e8 e8 fc ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  ;gdb) print (char*)(0x402378)</span><br><span class="line">  ;$2 &#x3D; 0x402378 &quot;which to blow yourself up. Have a nice day!&quot;</span><br><span class="line">  400e28:	bf 78 23 40 00       	mov    $0x402378,%edi</span><br><span class="line">  400e2d:	e8 de fc ff ff       	callq  400b10 &lt;puts@plt&gt;;打印提示信息</span><br><span class="line">  ; edi(第一参数寄存器)存放要打印的字符串的地址，通过callq  400b10 &lt;puts@plt&gt;打印</span><br><span class="line">  ;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  ;下面一段就是一个炸弹,炸弹先调用read_line,然后将返回的地址传递给phase_n函数，</span><br><span class="line">  ;如果输入的不正确那么就会执行爆炸函数输出bomb!</span><br><span class="line">  ;</span><br><span class="line">  ;</span><br><span class="line">  ;; 获取输入字符串,rax返回值是字符串地址</span><br><span class="line">  400e32:	e8 67 06 00 00       	callq  40149e &lt;read_line&gt;</span><br><span class="line">  ;; 获取的输入字符串地址赋给rdi</span><br><span class="line">  400e37:	48 89 c7             	mov    %rax,%rdi</span><br><span class="line">  400e3a:	e8 a1 00 00 00       	callq  400ee0 &lt;phase_1&gt;</span><br><span class="line">  400e3f:	e8 80 07 00 00       	callq  4015c4 &lt;phase_defused&gt;</span><br><span class="line">  400e44:	bf a8 23 40 00       	mov    $0x4023a8,%edi</span><br><span class="line">  400e49:	e8 c2 fc ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  400e4e:	e8 4b 06 00 00       	callq  40149e &lt;read_line&gt;</span><br><span class="line">  400e53:	48 89 c7             	mov    %rax,%rdi</span><br><span class="line">  400e56:	e8 a1 00 00 00       	callq  400efc &lt;phase_2&gt;</span><br><span class="line">  400e5b:	e8 64 07 00 00       	callq  4015c4 &lt;phase_defused&gt;</span><br><span class="line">  400e60:	bf ed 22 40 00       	mov    $0x4022ed,%edi</span><br><span class="line">  400e65:	e8 a6 fc ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  400e6a:	e8 2f 06 00 00       	callq  40149e &lt;read_line&gt;</span><br><span class="line">  400e6f:	48 89 c7             	mov    %rax,%rdi</span><br><span class="line">  400e72:	e8 cc 00 00 00       	callq  400f43 &lt;phase_3&gt;</span><br><span class="line">  400e77:	e8 48 07 00 00       	callq  4015c4 &lt;phase_defused&gt;</span><br><span class="line">  400e7c:	bf 0b 23 40 00       	mov    $0x40230b,%edi</span><br><span class="line">  400e81:	e8 8a fc ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  400e86:	e8 13 06 00 00       	callq  40149e &lt;read_line&gt;</span><br><span class="line">  400e8b:	48 89 c7             	mov    %rax,%rdi</span><br><span class="line">  400e8e:	e8 79 01 00 00       	callq  40100c &lt;phase_4&gt;</span><br><span class="line">  400e93:	e8 2c 07 00 00       	callq  4015c4 &lt;phase_defused&gt;</span><br><span class="line">  400e98:	bf d8 23 40 00       	mov    $0x4023d8,%edi</span><br><span class="line">  400e9d:	e8 6e fc ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  400ea2:	e8 f7 05 00 00       	callq  40149e &lt;read_line&gt;</span><br><span class="line">  400ea7:	48 89 c7             	mov    %rax,%rdi</span><br><span class="line">  400eaa:	e8 b3 01 00 00       	callq  401062 &lt;phase_5&gt;</span><br><span class="line">  400eaf:	e8 10 07 00 00       	callq  4015c4 &lt;phase_defused&gt;</span><br><span class="line">  400eb4:	bf 1a 23 40 00       	mov    $0x40231a,%edi</span><br><span class="line">  400eb9:	e8 52 fc ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  400ebe:	e8 db 05 00 00       	callq  40149e &lt;read_line&gt;</span><br><span class="line">  400ec3:	48 89 c7             	mov    %rax,%rdi</span><br><span class="line">  400ec6:	e8 29 02 00 00       	callq  4010f4 &lt;phase_6&gt;</span><br><span class="line">  400ecb:	e8 f4 06 00 00       	callq  4015c4 &lt;phase_defused&gt;</span><br><span class="line">  400ed0:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  400ed5:	5b                   	pop    %rbx</span><br><span class="line">  400ed6:	c3                   	retq   </span><br><span class="line">  400ed7:	90                   	nop</span><br><span class="line">  400ed8:	90                   	nop</span><br><span class="line">  400ed9:	90                   	nop</span><br><span class="line">  400eda:	90                   	nop</span><br><span class="line">  400edb:	90                   	nop</span><br><span class="line">  400edc:	90                   	nop</span><br><span class="line">  400edd:	90                   	nop</span><br><span class="line">  400ede:	90                   	nop</span><br><span class="line">  400edf:	90                   	nop</span><br></pre></td></tr></table></div></figure>
<p>查看<code>read_line</code></p>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">000000000040149e &lt;read_line&gt;:</span><br><span class="line">  40149e:	48 83 ec 08          	sub    $0x8,%rsp</span><br><span class="line">  4014a2:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  4014a7:	e8 4d ff ff ff       	callq  4013f9 &lt;skip&gt;</span><br><span class="line">  4014ac:	48 85 c0             	test   %rax,%rax</span><br><span class="line">  4014af:	75 6e                	jne    40151f &lt;read_line+0x81&gt;</span><br><span class="line">  4014b1:	48 8b 05 90 22 20 00 	mov    0x202290(%rip),%rax        # 603748 &lt;stdin@@GLIBC_2.2.5&gt;</span><br><span class="line">  4014b8:	48 39 05 a9 22 20 00 	cmp    %rax,0x2022a9(%rip)        # 603768 &lt;infile&gt;</span><br><span class="line">  4014bf:	75 14                	jne    4014d5 &lt;read_line+0x37&gt;</span><br><span class="line">  4014c1:	bf d5 25 40 00       	mov    $0x4025d5,%edi</span><br><span class="line">  4014c6:	e8 45 f6 ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  4014cb:	bf 08 00 00 00       	mov    $0x8,%edi</span><br><span class="line">  4014d0:	e8 4b f7 ff ff       	callq  400c20 &lt;exit@plt&gt;</span><br><span class="line">  4014d5:	bf f3 25 40 00       	mov    $0x4025f3,%edi</span><br><span class="line">  4014da:	e8 01 f6 ff ff       	callq  400ae0 &lt;getenv@plt&gt;</span><br><span class="line">  </span><br><span class="line">  4014df:	48 85 c0             	test   %rax,%rax</span><br><span class="line">  ; rax为零则跳转到4014ee,否则edi清零并callq  400c20 &lt;exit@plt&gt;</span><br><span class="line">  4014e2:	74 0a                	je     4014ee &lt;read_line+0x50&gt;</span><br><span class="line">  4014e4:	bf 00 00 00 00       	mov    $0x0,%edi</span><br><span class="line">  4014e9:	e8 32 f7 ff ff       	callq  400c20 &lt;exit@plt&gt;</span><br><span class="line">  </span><br><span class="line">  4014ee:	48 8b 05 53 22 20 00 	mov    0x202253(%rip),%rax        # 603748 &lt;stdin@@GLIBC_2.2.5&gt;</span><br><span class="line">  4014f5:	48 89 05 6c 22 20 00 	mov    %rax,0x20226c(%rip)        # 603768 &lt;infile&gt;</span><br><span class="line">  4014fc:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  401501:	e8 f3 fe ff ff       	callq  4013f9 &lt;skip&gt;</span><br><span class="line">  401506:	48 85 c0             	test   %rax,%rax</span><br><span class="line">  401509:	75 14                	jne    40151f &lt;read_line+0x81&gt;</span><br><span class="line">  40150b:	bf d5 25 40 00       	mov    $0x4025d5,%edi</span><br><span class="line">  401510:	e8 fb f5 ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  401515:	bf 00 00 00 00       	mov    $0x0,%edi</span><br><span class="line">  40151a:	e8 01 f7 ff ff       	callq  400c20 &lt;exit@plt&gt;</span><br><span class="line">  40151f:	8b 15 3b 22 20 00    	mov    0x20223b(%rip),%edx        # 603760 &lt;num_input_strings&gt;</span><br><span class="line">  401525:	48 63 c2             	movslq %edx,%rax</span><br><span class="line">  401528:	48 8d 34 80          	lea    (%rax,%rax,4),%rsi</span><br><span class="line">  40152c:	48 c1 e6 04          	shl    $0x4,%rsi</span><br><span class="line">  401530:	48 81 c6 80 37 60 00 	add    $0x603780,%rsi</span><br><span class="line">  401537:	48 89 f7             	mov    %rsi,%rdi</span><br><span class="line">  40153a:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  40153f:	48 c7 c1 ff ff ff ff 	mov    $0xffffffffffffffff,%rcx</span><br><span class="line">  401546:	f2 ae                	repnz scas %es:(%rdi),%al</span><br><span class="line">  401548:	48 f7 d1             	not    %rcx</span><br><span class="line">  40154b:	48 83 e9 01          	sub    $0x1,%rcx</span><br><span class="line">  40154f:	83 f9 4e             	cmp    $0x4e,%ecx</span><br><span class="line">  ;ecx有符号小于等于0x4e则跳转到40159a(引爆炸弹的下一条指令处)</span><br><span class="line">  401552:	7e 46                	jle    40159a &lt;read_line+0xfc&gt; </span><br><span class="line">  </span><br><span class="line">  401554:	bf fe 25 40 00       	mov    $0x4025fe,%edi</span><br><span class="line">  401559:	e8 b2 f5 ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  40155e:	8b 05 fc 21 20 00    	mov    0x2021fc(%rip),%eax        # 603760 &lt;num_input_strings&gt;</span><br><span class="line">  401564:	8d 50 01             	lea    0x1(%rax),%edx</span><br><span class="line">  401567:	89 15 f3 21 20 00    	mov    %edx,0x2021f3(%rip)        # 603760 &lt;num_input_strings&gt;</span><br><span class="line">  40156d:	48 98                	cltq   </span><br><span class="line">  40156f:	48 6b c0 50          	imul   $0x50,%rax,%rax</span><br><span class="line">  401573:	48 bf 2a 2a 2a 74 72 	movabs $0x636e7572742a2a2a,%rdi</span><br><span class="line">  40157a:	75 6e 63 </span><br><span class="line">  40157d:	48 89 b8 80 37 60 00 	mov    %rdi,0x603780(%rax)</span><br><span class="line">  401584:	48 bf 61 74 65 64 2a 	movabs $0x2a2a2a64657461,%rdi</span><br><span class="line">  40158b:	2a 2a 00 </span><br><span class="line">  40158e:	48 89 b8 88 37 60 00 	mov    %rdi,0x603788(%rax)</span><br><span class="line">  401595:	e8 a0 fe ff ff       	callq  40143a &lt;explode_bomb&gt; ;引爆炸弹</span><br><span class="line">  40159a:	83 e9 01             	sub    $0x1,%ecx</span><br><span class="line">  40159d:	48 63 c9             	movslq %ecx,%rcx</span><br><span class="line">  4015a0:	48 63 c2             	movslq %edx,%rax</span><br><span class="line">  4015a3:	48 8d 04 80          	lea    (%rax,%rax,4),%rax</span><br><span class="line">  4015a7:	48 c1 e0 04          	shl    $0x4,%rax</span><br><span class="line">  4015ab:	c6 84 01 80 37 60 00 	movb   $0x0,0x603780(%rcx,%rax,1)</span><br><span class="line">  4015b2:	00 </span><br><span class="line">  4015b3:	83 c2 01             	add    $0x1,%edx</span><br><span class="line">  4015b6:	89 15 a4 21 20 00    	mov    %edx,0x2021a4(%rip)        # 603760 &lt;num_input_strings&gt;</span><br><span class="line">  4015bc:	48 89 f0             	mov    %rsi,%rax</span><br><span class="line">  4015bf:	48 83 c4 08          	add    $0x8,%rsp</span><br><span class="line">  4015c3:	c3                   	retq   </span><br></pre></td></tr></table></div></figure>
<p><code>strings_not_equal</code>函数</p>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">0000000000401338 &lt;strings_not_equal&gt;:</span><br><span class="line">  401338:	41 54                	push   %r12</span><br><span class="line">  40133a:	55                   	push   %rbp </span><br><span class="line">  40133b:	53                   	push   %rbx ; rbp,rbx压栈,说明该函数要使用</span><br><span class="line">  ; 分别赋值rdi,rsi,说明匹配的字符串地址应该在rdi,rsi处</span><br><span class="line">  40133c:	48 89 fb             	mov    %rdi,%rbx ;</span><br><span class="line">  40133f:	48 89 f5             	mov    %rsi,%rbp </span><br><span class="line">  </span><br><span class="line">  401342:	e8 d4 ff ff ff       	callq  40131b &lt;string_length&gt;</span><br><span class="line">  401347:	41 89 c4             	mov    %eax,%r12d</span><br><span class="line">  40134a:	48 89 ef             	mov    %rbp,%rdi</span><br><span class="line">  40134d:	e8 c9 ff ff ff       	callq  40131b &lt;string_length&gt;</span><br><span class="line">  401352:	ba 01 00 00 00       	mov    $0x1,%edx</span><br><span class="line">  401357:	41 39 c4             	cmp    %eax,%r12d</span><br><span class="line">  40135a:	75 3f                	jne    40139b &lt;strings_not_equal+0x63&gt;</span><br><span class="line">  40135c:	0f b6 03             	movzbl (%rbx),%eax</span><br><span class="line">  40135f:	84 c0                	test   %al,%al</span><br><span class="line">  401361:	74 25                	je     401388 &lt;strings_not_equal+0x50&gt;</span><br><span class="line">  401363:	3a 45 00             	cmp    0x0(%rbp),%al</span><br><span class="line">  401366:	74 0a                	je     401372 &lt;strings_not_equal+0x3a&gt;</span><br><span class="line">  401368:	eb 25                	jmp    40138f &lt;strings_not_equal+0x57&gt;</span><br><span class="line">  40136a:	3a 45 00             	cmp    0x0(%rbp),%al</span><br><span class="line">  40136d:	0f 1f 00             	nopl   (%rax)</span><br><span class="line">  401370:	75 24                	jne    401396 &lt;strings_not_equal+0x5e&gt;</span><br><span class="line">  401372:	48 83 c3 01          	add    $0x1,%rbx</span><br><span class="line">  401376:	48 83 c5 01          	add    $0x1,%rbp</span><br><span class="line">  40137a:	0f b6 03             	movzbl (%rbx),%eax</span><br><span class="line">  40137d:	84 c0                	test   %al,%al</span><br><span class="line">  40137f:	75 e9                	jne    40136a &lt;strings_not_equal+0x32&gt;</span><br><span class="line">  401381:	ba 00 00 00 00       	mov    $0x0,%edx</span><br><span class="line">  401386:	eb 13                	jmp    40139b &lt;strings_not_equal+0x63&gt;</span><br><span class="line">  401388:	ba 00 00 00 00       	mov    $0x0,%edx</span><br><span class="line">  40138d:	eb 0c                	jmp    40139b &lt;strings_not_equal+0x63&gt;</span><br><span class="line">  40138f:	ba 01 00 00 00       	mov    $0x1,%edx</span><br><span class="line">  401394:	eb 05                	jmp    40139b &lt;strings_not_equal+0x63&gt;</span><br><span class="line">  401396:	ba 01 00 00 00       	mov    $0x1,%edx</span><br><span class="line">  40139b:	89 d0                	mov    %edx,%eax</span><br><span class="line">  40139d:	5b                   	pop    %rbx</span><br><span class="line">  40139e:	5d                   	pop    %rbp</span><br><span class="line">  40139f:	41 5c                	pop    %r12</span><br><span class="line">  4013a1:	c3                   	retq   </span><br></pre></td></tr></table></div></figure>

        <h4 id="第一个炸弹"   >
          <a href="#第一个炸弹" class="heading-link"><i class="fas fa-link"></i></a>第一个炸弹</h4>
      
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">0000000000400ee0 &lt;phase_1&gt;:</span><br><span class="line">  400ee0:	48 83 ec 08          	sub    $0x8,%rsp ;申请8字节栈空间</span><br><span class="line">  ;给寄存器esi(rsi低32位)赋值,应该是一个地址,esi(rsi)是第二个参数寄存器</span><br><span class="line">  400ee4:	be 00 24 40 00       	mov    $0x402400,%esi ;</span><br><span class="line">  ;调用匹配字符串函数</span><br><span class="line">  400ee9:	e8 4a 04 00 00       	callq  401338 &lt;strings_not_equal&gt;</span><br><span class="line">  ;测试匹配函数结束后的eax(返回值rax低32位)寄存器值,若0,栈复原退出,否则调用炸弹爆炸函数</span><br><span class="line">  400eee:	85 c0                	test   %eax,%eax</span><br><span class="line">  400ef0:	74 05                	je     400ef7 &lt;phase_1+0x17&gt;</span><br><span class="line">  400ef2:	e8 43 05 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400ef7:	48 83 c4 08          	add    $0x8,%rsp</span><br><span class="line">  400efb:	c3                   	retq   </span><br></pre></td></tr></table></div></figure>
<p>结合phase1的代码</p>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">;; 获取输入字符串,rax返回值是字符串地址</span><br><span class="line"> 400e32:	e8 67 06 00 00       	callq  40149e &lt;read_line&gt;</span><br><span class="line"> ;; 获取的输入字符串地址赋给rdi</span><br><span class="line"> 400e37:	48 89 c7             	mov    %rax,%rdi</span><br><span class="line"> 400e3a:	e8 a1 00 00 00       	callq  400ee0 &lt;phase_1&gt;</span><br><span class="line"> 400e3f:	e8 80 07 00 00       	callq  4015c4 &lt;phase_defused&gt;</span><br><span class="line"> 400e44:	bf a8 23 40 00       	mov    $0x4023a8,%edi </span><br><span class="line"> 400e49:	e8 c2 fc ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br></pre></td></tr></table></div></figure>
<p><code>read_line</code>函数会将读入字符串地址存放在<code>rdi</code>和<code>rsi</code>中，<code>strings_not_equa</code>l函数会使用<code>edi</code>和<code>esi</code>中的值当做两个字符址，并且判断他们是否相等，相等返回0</p>
<p><code>edi</code>存放的是<code>callq 400b10 &lt;puts@plt&gt;</code>要打印的信息的地址，用gdb调试</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">print</span> (char*)(0x4023a8)</span><br><span class="line"><span class="variable">$3</span> = 0x4023a8 <span class="string">&quot;Phase 1 defused. How about the next one?&quot;</span></span><br></pre></td></tr></table></div></figure>
<p>可见打印的是成功拆除的信息。因此，炸弹1的整体逻辑就是</p>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A[开始] --&gt; B[ 函数readline ]</span><br><span class="line">     B--&gt; C(rdi&#x3D;&amp;输入字符串&lt;br&gt;rsi&#x3D;&amp;密钥字符串) --&gt; D&#123;string_not_equal&#125;</span><br><span class="line">     D--&gt; |返回0| E[puts success info]</span><br><span class="line">     D--&gt; |返回非0| F[bomb_explode]</span><br></pre></td></tr></table></div></figure>
<p>于是，重点在于找到给<code>rsi</code>赋地址的语句，这个地址存储的就是密钥字符串</p>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0000000000400ee0 &lt;phase_1&gt;:</span><br><span class="line">  400ee0:	48 83 ec 08          	sub    $0x8,%rsp ;申请8字节栈空间</span><br><span class="line">  ;给寄存器esi(rsi低32位)赋值,应该是一个地址,esi(rsi)是第二个参数寄存器</span><br><span class="line">  400ee4:	be 00 24 40 00       	mov    $0x402400,%esi ; rsi赋地址语句</span><br></pre></td></tr></table></div></figure>
<p><code>esi</code>是<code>rsi</code>的低32位，400ee4给<code>esi</code>赋值就是给<code>rsi</code>赋值为密钥字符串地址</p>
<p><code>gdb</code>调试</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">print</span> (char*) (0x402400)</span><br><span class="line"><span class="variable">$7</span> = 0x402400 <span class="string">&quot;Border relations with Canada have never been better.&quot;</span></span><br></pre></td></tr></table></div></figure>
<p>第一个炸弹的密钥就是**“Border relations with Canada have never been better.”**</p>

        <h4 id="第二个炸弹"   >
          <a href="#第二个炸弹" class="heading-link"><i class="fas fa-link"></i></a>第二个炸弹</h4>
      
<p>查看<code>phase_2</code>代码</p>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">0000000000400efc &lt;phase_2&gt;:</span><br><span class="line">  400efc:	55                   	push   %rbp</span><br><span class="line">  400efd:	53                   	push   %rbx ; rbx rbp压栈，要被调用</span><br><span class="line">  400efe:	48 83 ec 28          	sub    $0x28,%rsp ; 申请0x28&#x3D;40字节栈帧</span><br><span class="line">  400f02:	48 89 e6             	mov    %rsp,%rsi ; 将rsp值赋给rsi</span><br><span class="line">  ;根据函数名,应该是读入六个数</span><br><span class="line">  400f05:	e8 52 05 00 00       	callq  40145c &lt;read_six_numbers&gt;</span><br><span class="line">  </span><br><span class="line">  400f0a:	83 3c 24 01          	cmpl   $0x1,(%rsp); 查栈顶元素是否是1,</span><br><span class="line">  													  ; 由下文分析可知phase_2栈顶存储的是第一个输入的值</span><br><span class="line">  													  ; 因此密钥第一个数字必定是1</span><br><span class="line">  400f0e:	74 20                	je     400f30 &lt;phase_2+0x34&gt;;是1，跳转到400f30进行首轮哨兵初始化等操作,不是则引爆炸弹</span><br><span class="line">  400f10:	e8 25 05 00 00       	callq  40143a &lt;explode_bomb&gt; ;引爆炸弹</span><br><span class="line">  400f15:	eb 19                	jmp    400f30 &lt;phase_2+0x34&gt; </span><br><span class="line">  </span><br><span class="line">  ;取出rbx-4处的值赋给eax</span><br><span class="line">  400f17:	8b 43 fc             	mov    -0x4(%rbx),%eax</span><br><span class="line">  400f1a:	01 c0                	add    %eax,%eax; eax&#x3D;2*eax</span><br><span class="line">  ;比较eax*2和rbx处的值,注意:eax是rbx-4处的值，即将rbx和前一个数的两倍比较</span><br><span class="line">  400f1c:	39 03                	cmp    %eax,(%rbx)</span><br><span class="line">  ; rbx和前一个数的两倍相等则跳转</span><br><span class="line">  400f1e:	74 05                	je     400f25 &lt;phase_2+0x29&gt; </span><br><span class="line">  ; 不相等引爆炸弹</span><br><span class="line">  400f20:	e8 15 05 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  ; rbx&#x3D;rbx+4</span><br><span class="line">  400f25:	48 83 c3 04          	add    $0x4,%rbx</span><br><span class="line">  ; 将rbx和rbp比较</span><br><span class="line">  ;将加4后的值和rbp比较，</span><br><span class="line">  ;注意rbp是rsp+24 (400f30代码),而rsp是第一个数，一个数四个字节。那么rbp就应该是</span><br><span class="line">  ;后那个数后面那个地址，即rbp是个循环哨兵</span><br><span class="line">  400f29:	48 39 eb             	cmp    %rbp,%rbx</span><br><span class="line">  ; 不相等跳转回rbx-4，继续取rbx前一个数的两倍与其比较</span><br><span class="line">  400f2c:	75 e9                	jne    400f17 &lt;phase_2+0x1b&gt;</span><br><span class="line">  ; 相等则直接跳转出去</span><br><span class="line">  400f2e:	eb 0c                	jmp    400f3c &lt;phase_2+0x40&gt;</span><br><span class="line">  </span><br><span class="line">  400f30:	48 8d 5c 24 04       	lea    0x4(%rsp),%rbx ;将rsp+4存到rbx</span><br><span class="line">  400f35:	48 8d 6c 24 18       	lea    0x18(%rsp),%rbp ; 将rsp +24 存到rbp</span><br><span class="line">  ; 无条件跳回去,取rbx前一个数的两倍与其比较</span><br><span class="line">  400f3a:	eb db                	jmp    400f17 &lt;phase_2+0x1b&gt; </span><br><span class="line">  </span><br><span class="line">  400f3c:	48 83 c4 28          	add    $0x28,%rsp</span><br><span class="line">  400f40:	5b                   	pop    %rbx</span><br><span class="line">  400f41:	5d                   	pop    %rbp</span><br><span class="line">  400f42:	c3                   	retq   </span><br></pre></td></tr></table></div></figure>
<p>查看<code>read_six_number</code>代码</p>
<p>内部调用了<code>sscanf</code> 这个函数（功能是从一个字符串中读取一定格式的数据，和 <code>scanf</code> 一样，除了 <code>scanf</code> 是从标准输入流中读取）。参数顺序分别是，待读取内容的字符串(<code>rdi</code>)、用于格式读取的格式化字符串(<code>rsi</code>)，还有各个变量读取后存放的地址(<code>rdx</code>)。返回读到的有效数据个数</p>
<ul>
<li><code>%rdx</code>由 <code>%rsi</code> 给出，<code>%rsi</code> 又由 <code>phrase2</code> 的 <code>%rsp</code> 给出，所以 <code>phrase2</code> 中的 <code>%rsp</code> 地址处存放 <code>sscanf</code> 中第1个输入的值。</li>
</ul>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">000000000040145c &lt;read_six_numbers&gt;:</span><br><span class="line">  40145c:	48 83 ec 18          	sub    $0x18,%rsp ; 申请0x18&#x3D;24字节栈帧</span><br><span class="line">  401460:	48 89 f2             	mov    %rsi,%rdx; rdx&#x3D;rsi</span><br><span class="line">  401463:	48 8d 4e 04          	lea    0x4(%rsi),%rcx; rcx&#x3D;rsi+4</span><br><span class="line">  </span><br><span class="line">  ;                                       	rax&#x3D;rsi+0x14</span><br><span class="line">  401467:	48 8d 46 14          	lea    0x14(%rsi),%rax</span><br><span class="line">  40146b:	48 89 44 24 08       	mov    %rax,0x8(%rsp);将rax存入rsp+8处</span><br><span class="line">  ;此时栈</span><br><span class="line">  ;| ......... |  &lt;- rsi,rdx </span><br><span class="line">  ;|  返回地址  |</span><br><span class="line">  ;|           |</span><br><span class="line">  ;|  rsi+0x14 |</span><br><span class="line">  ;|           |  &lt;- rsp</span><br><span class="line">  </span><br><span class="line">  401470:	48 8d 46 10          	lea    0x10(%rsi),%rax; rax&#x3D;rsi+0x10</span><br><span class="line">  401474:	48 89 04 24          	mov    %rax,(%rsp); 将rax存入rsp处</span><br><span class="line">  ;此时栈</span><br><span class="line">  ;| ......... |  &lt;- rsi,rdx </span><br><span class="line">  ;|  返回地址  |</span><br><span class="line">  ;|           |</span><br><span class="line">  ;|  rsi+0x14 |</span><br><span class="line">  ;|  rsi+0x10 |  &lt;- rsp</span><br><span class="line">  401478:	4c 8d 4e 0c          	lea    0xc(%rsi),%r9</span><br><span class="line">  40147c:	4c 8d 46 08          	lea    0x8(%rsi),%r8</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  ;将rsi赋值为0x4025c3</span><br><span class="line">  401480:	be c3 25 40 00       	mov    $0x4025c3,%esi</span><br><span class="line">  401485:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  ;调用了scanf</span><br><span class="line">  40148a:	e8 61 f7 ff ff       	callq  400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  40148f:	83 f8 05             	cmp    $0x5,%eax</span><br><span class="line">  ; eax 大于5 跳转到401499准备返回,否则调用爆炸函数,eax存放的应该是读到的数字个数</span><br><span class="line">  401492:	7f 05                	jg     401499 &lt;read_six_numbers+0x3d&gt;</span><br><span class="line">  401494:	e8 a1 ff ff ff       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  ; 释放栈帧，返回</span><br><span class="line">  401499:	48 83 c4 18          	add    $0x18,%rsp</span><br><span class="line">  40149d:	c3                   	retq   </span><br></pre></td></tr></table></div></figure>
<ul>
<li>
<p><code>%rcx</code>，<code>phrase2</code> 中的 <code>%rsp+0x4</code> 处存放第2个值</p>
</li>
<li>
<p><code>%r8</code>，<code>phrase2</code> 中的 <code>%rsp+0x8</code> 存放第3个值</p>
</li>
<li>
<p><code>%r9</code>，<code>phrase2</code> 中的 <code>%rsp+0xc</code> 存放第4个值</p>
</li>
<li>
<p>第5个、第6个值所在的地址需要通过压栈传参，参数的入栈顺序是从右至左。可知，<code>phrase2</code> 中的 <code>%rsp+0x10</code> 存放第五个值、<code>phrase2</code> 中的 <code>%rsp+0x14</code> 存放第六个值。第六个值先入栈，更加靠近栈底（高地址）。</p>
</li>
</ul>
<p>打印0x4025c3处的值</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x /4wd 0x4025c3</span><br><span class="line">0x4025c3:	622879781	1680154724	543434016	622879781</span><br></pre></td></tr></table></div></figure>
<p>乱七八糟，尝试用字符串打印</p>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) print (char*)0x4025c3</span><br><span class="line">$5 &#x3D; 0x4025c3 &quot;%d %d %d %d %d %d&quot;</span><br></pre></td></tr></table></div></figure>
<p>这说明<code>sscanf</code>读取的确实是6个数字。可以确定，第2个炸弹的密钥是<strong>1 2 4 8 16 32</strong></p>

        <h4 id="第三个炸弹"   >
          <a href="#第三个炸弹" class="heading-link"><i class="fas fa-link"></i></a>第三个炸弹</h4>
      
<p>查看<code>phase_3</code>代码</p>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0000000000400f43 &lt;phase_3&gt;:</span><br><span class="line">  400f43:	48 83 ec 18          	sub    $0x18,%rsp</span><br><span class="line">  400f47:	48 8d 4c 24 0c       	lea    0xc(%rsp),%rcx ; rcx存储接受输入的第2个数字的地址</span><br><span class="line">  400f4c:	48 8d 54 24 08       	lea    0x8(%rsp),%rdx ; rdx 是sscanf接受输入字符串的地址,为rsp+8</span><br><span class="line">  </span><br><span class="line">  400f51:	be cf 25 40 00       	mov    $0x4025cf,%esi ;esi(rsi)为sscanf的第二个参数,输入格式</span><br><span class="line">  400f56:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  400f5b:	e8 90 fc ff ff       	callq  400bf0 &lt;__isoc99_sscanf@plt&gt; ; 又调用sscanf获取输入</span><br><span class="line">  </span><br></pre></td></tr></table></div></figure>
<p>代码开头就调用了<code>sscanf</code>，所以这个函数前面一定会有一个字符串常量存储需要读取的数据格式，函数的第二个参数用<code>rsi(esi)</code>存储，<code>400f51:</code>处代码告诉了<code>esi</code>的字符串首地址是<code>0x4025cf</code>，</p>
<p>使用<code>gdb</code>调试</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">print</span> (char*) 0x4025cf</span><br><span class="line"><span class="variable">$1</span> = 0x4025cf <span class="string">&quot;%d %d&quot;</span></span><br></pre></td></tr></table></div></figure>
<p>确定这个炸弹的输入是两个数字</p>
<p>继续查看代码，发现其<code>cmp,jmp</code>等跳转指令很多，而且极其的有规律，猜测是个switch语句</p>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">400f60:	83 f8 01             	cmp    $0x1,%eax ; eax与1比较,应该是返回值sscanf返回读到的2数据个数</span><br><span class="line">; eax大于1 跳转L1,否则触发爆炸,因为密钥是2个数字,小于等于1个有效数据肯定错误</span><br><span class="line">400f63:	7f 05                	jg     400f6a &lt;phase_3+0x27&gt;</span><br><span class="line">400f65:	e8 d0 04 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">; L1, 结合上文代码,这是比较ssacnf获取的第一个输入数据和0x7的大小</span><br><span class="line">400f6a:	83 7c 24 08 07       	cmpl   $0x7,0x8(%rsp)</span><br><span class="line">; 无符号大于7跳转到L2爆炸</span><br><span class="line">400f6f:	77 3c                	ja     400fad &lt;phase_3+0x6a&gt;</span><br><span class="line">; 无符号小于等于7, 将eax赋值为sscanf获取的第一个输入</span><br><span class="line">400f71:	8b 44 24 08          	mov    0x8(%rsp),%eax</span><br><span class="line">; 间接跳转, 跳转到 (0x402470+%rax*8)内存数据表示的地址,这是switch典型代码,0x402470存储的应该是一个跳转表</span><br><span class="line">400f75:	ff 24 c5 70 24 40 00 	jmpq   *0x402470(,%rax,8)</span><br><span class="line">; 跳转表元素的每个数据应该是下面的一段,进行一次mov操作,修改eax值后统一跳转到400fbe处</span><br><span class="line">; case1</span><br><span class="line">400f7c:	b8 cf 00 00 00       	mov    $0xcf,%eax</span><br><span class="line">400f81:	eb 3b                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">; case2</span><br><span class="line">400f83:	b8 c3 02 00 00       	mov    $0x2c3,%eax</span><br><span class="line">400f88:	eb 34                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">; case3</span><br><span class="line">400f8a:	b8 00 01 00 00       	mov    $0x100,%eax</span><br><span class="line">400f8f:	eb 2d                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">; case4</span><br><span class="line">400f91:	b8 85 01 00 00       	mov    $0x185,%eax</span><br><span class="line">400f96:	eb 26                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">; case5</span><br><span class="line">400f98:	b8 ce 00 00 00       	mov    $0xce,%eax</span><br><span class="line">400f9d:	eb 1f                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">; case6</span><br><span class="line">400f9f:	b8 aa 02 00 00       	mov    $0x2aa,%eax</span><br><span class="line">400fa4:	eb 18                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">; case7</span><br><span class="line">400fa6:	b8 47 01 00 00       	mov    $0x147,%eax</span><br><span class="line">400fab:	eb 11                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">; L2 触发爆炸</span><br><span class="line">400fad:	e8 88 04 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">400fb2:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">400fb7:	eb 05                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">;?</span><br><span class="line">400fb9:	b8 37 01 00 00       	mov    $0x137,%eax</span><br><span class="line">; case 结束后跳转到的地方</span><br><span class="line">; 显然这里是把ssacnf获取的第二个输入数字与case处理后的eax比较</span><br><span class="line">400fbe:	3b 44 24 0c          	cmp    0xc(%rsp),%eax</span><br><span class="line">; 若相等,则复原栈帧跳出去</span><br><span class="line">400fc2:	74 05                	je     400fc9 &lt;phase_3+0x86&gt;</span><br><span class="line">; 不等就爆炸</span><br><span class="line">400fc4:	e8 71 04 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">400fc9:	48 83 c4 18          	add    $0x18,%rsp</span><br><span class="line">400fcd:	c3                   	retq   </span><br></pre></td></tr></table></div></figure>
<p>因此本题答案可不唯一，第一个数字应该无符号小于等于7，</p>
<p><code>gdb</code>打印跳转表</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x /8gx 0x402470</span><br><span class="line">0x402470:	0x0000000000400f7c [case1]		0x0000000000400fb9 [?]</span><br><span class="line">0x402480:	0x0000000000400f83 [case2]     	0x0000000000400f8a [case3]</span><br><span class="line">0x402490:	0x0000000000400f91 [case4]		0x0000000000400f98 [case5]</span><br><span class="line">0x4024a0:	0x0000000000400f9f [case6]      0x0000000000400fa6 [case7]</span><br></pre></td></tr></table></div></figure>
<p>因此 假设第一个数字是0，那么跳转到的是<code>case1</code>，<code>eax=0xcf</code>，第二个数字得是<code>0xcf=207</code></p>
<p>第一个数字是1，跳转到？,<code>eax=0x137=311</code></p>

        <h4 id="第四个炸弹"   >
          <a href="#第四个炸弹" class="heading-link"><i class="fas fa-link"></i></a>第四个炸弹</h4>
      
<p>查看<code>phase_4</code>代码，考察的是函数递归调用</p>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">000000000040100c &lt;phase_4&gt;:</span><br><span class="line">  40100c:	48 83 ec 18          	sub    $0x18,%rsp ; 申请0x18&#x3D;24直接栈帧</span><br><span class="line">  ;| phase_4 ret addr |</span><br><span class="line">  ;|                  |	 &lt;- rcx   (sscanf 输入2nd)</span><br><span class="line">  ;|                  |  &lt;- rdx   (sscanf 输入1st)</span><br><span class="line">  ;|                  |  &lt;- rsp</span><br><span class="line">  401010:	48 8d 4c 24 0c       	lea    0xc(%rsp),%rcx</span><br><span class="line">  401015:	48 8d 54 24 08       	lea    0x8(%rsp),%rdx ; sscanf获取的输入存放的地址</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  40101a:	be cf 25 40 00       	mov    $0x4025cf,%esi;esi(rsi)为sscanf的第二个参数,输入格式</span><br><span class="line">  40101f:	b8 00 00 00 00       	mov    $0x0,%eax ; eax(rax)清零 </span><br><span class="line">  401024:	e8 c7 fb ff ff       	callq  400bf0 &lt;__isoc99_sscanf@plt&gt;; 调用sscanf</span><br><span class="line">  401029:	83 f8 02             	cmp    $0x2,%eax; sscanf返回的eax是有效数据个数，判断是否是2</span><br><span class="line">  ; 不相等跳转到爆炸处,有效输入个数不是2,必然和密钥不匹配,错误</span><br><span class="line">  40102c:	75 07                	jne    401035 &lt;phase_4+0x29&gt;</span><br><span class="line">  ; 是2个有效输入,比较第一个输入和0xe&#x3D;14</span><br><span class="line">  40102e:	83 7c 24 08 0e       	cmpl   $0xe,0x8(%rsp)</span><br><span class="line">  ; 第一个输入无符号小于等于14 跳转避开炸弹,否则到401035处爆炸</span><br><span class="line">  401033:	76 05                	jbe    40103a &lt;phase_4+0x2e&gt;</span><br><span class="line">  ; 引爆炸弹</span><br><span class="line">  401035:	e8 00 04 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  ; 避开炸弹跳转点,将edx置为0xe&#x3D;14</span><br><span class="line">  40103a:	ba 0e 00 00 00       	mov    $0xe,%edx</span><br><span class="line">  ; esi清零</span><br><span class="line">  40103f:	be 00 00 00 00       	mov    $0x0,%esi</span><br><span class="line">  ; edi置为sscanf获取的第一个输入</span><br><span class="line">  401044:	8b 7c 24 08          	mov    0x8(%rsp),%edi</span><br><span class="line">  ; 调用func4函数</span><br><span class="line">  ;| phase_4 ret addr |</span><br><span class="line">  ;|                  |	 &lt;- rcx   (sscanf 输入2nd)</span><br><span class="line">  ;|                  |  &lt;- rdx   (sscanf 输入1st)</span><br><span class="line">  ;|                  | </span><br><span class="line">  ;| func4  ret addr  |  &lt;- rsp</span><br><span class="line">  ;|                  |</span><br><span class="line">  401048:	e8 81 ff ff ff       	callq  400fce &lt;func4&gt;</span><br><span class="line">  ; 调用结束后检查 eax</span><br><span class="line">  40104d:	85 c0                	test   %eax,%eax</span><br><span class="line">  ;  返回值非零引爆炸弹</span><br><span class="line">  40104f:	75 07                	jne    401058 &lt;phase_4+0x4c&gt;</span><br><span class="line">  ; 返回值为零 将第二个输入与0做比较</span><br><span class="line">  401051:	83 7c 24 0c 00       	cmpl   $0x0,0xc(%rsp)</span><br><span class="line">  ; 第二个输入是0 则跳出,否则仍然引爆炸弹</span><br><span class="line">  401056:	74 05                	je     40105d &lt;phase_4+0x51&gt;</span><br><span class="line">  ; 引爆炸弹</span><br><span class="line">  401058:	e8 dd 03 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  40105d:	48 83 c4 18          	add    $0x18,%rsp</span><br><span class="line">  401061:	c3                   	retq  </span><br></pre></td></tr></table></div></figure>
<p>又调用了<code>sscanf</code>函数，<code>esi</code>与<code>phase_3</code>中地址相同，因此输入格式又是<code>&quot;%d %d&quot;</code></p>
<p>其调用了一个函数<code>func4</code></p>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">0000000000400fce &lt;func4&gt;:</span><br><span class="line">  400fce:	48 83 ec 08          	sub    $0x8,%rsp ;申请8字节栈帧</span><br><span class="line">  ;| phase_4 ret addr |</span><br><span class="line">  ;|      ...         |	 &lt;- rcx (ecx)   (sscanf 输入2nd)</span><br><span class="line">  ;|      ...         |  &lt;- rdx (edx)  (sscanf 输入1st)</span><br><span class="line">  ;|                  | </span><br><span class="line">  ;| func4  ret addr  |  </span><br><span class="line">  ;|                  |  &lt;- rsp</span><br><span class="line">  ; 初次调用:edx&#x3D;14,esi&#x3D;0, edi &#x3D; sscanf input 1</span><br><span class="line">  ; 此前edx被赋值为0xe&#x3D;14,现eax&#x3D;14</span><br><span class="line">  400fd2:	89 d0                	mov    %edx,%eax</span><br><span class="line">  ; eax&#x3D;eax-esi  更新eax</span><br><span class="line">  400fd4:	29 f0                	sub    %esi,%eax</span><br><span class="line">  ; ecx&#x3D;eax</span><br><span class="line">  400fd6:	89 c1                	mov    %eax,%ecx</span><br><span class="line">  ; 将ecx逻辑右移(加0右移)31位,ecx长为32位,也就是之前的最高位变为最低位,其余31位填充补0</span><br><span class="line">  400fd8:	c1 e9 1f             	shr    $0x1f,%ecx</span><br><span class="line">  ; eax&#x3D;eax+(eax最高位)</span><br><span class="line">  400fdb:	01 c8                	add    %ecx,%eax</span><br><span class="line">  ; 这里是一个缩写 sar $1,%eax (对应的机器码为 D1F8)  eax &#x3D; eax&#x2F;2</span><br><span class="line">  400fdd:	d1 f8                	sar    %eax</span><br><span class="line">  ; ecx&#x3D; rax+rsi</span><br><span class="line">  400fdf:	8d 0c 30             	lea    (%rax,%rsi,1),%ecx</span><br><span class="line">  ; ecx和edi比较</span><br><span class="line">  400fe2:	39 f9                	cmp    %edi,%ecx</span><br><span class="line">  ; ecx小于等于edi则跳至另一个递归方案</span><br><span class="line">  400fe4:	7e 0c                	jle    400ff2 &lt;func4+0x24&gt;</span><br><span class="line">  ; 否则 edx&#x3D;rcx-1</span><br><span class="line">  400fe6:	8d 51 ff             	lea    -0x1(%rcx),%edx</span><br><span class="line">  ; 递归调用func4</span><br><span class="line">  400fe9:	e8 e0 ff ff ff       	callq  400fce &lt;func4&gt;</span><br><span class="line">  ; eax&#x3D;2*eax</span><br><span class="line">  400fee:	01 c0                	add    %eax,%eax</span><br><span class="line">  ; 本层递归结束,递归出口，回上一层递归</span><br><span class="line">  400ff0:	eb 15                	jmp    401007 &lt;func4+0x39&gt;</span><br><span class="line">  ; 另一个递归方案 , eax清零</span><br><span class="line">  400ff2:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  400ff7:	39 f9                	cmp    %edi,%ecx</span><br><span class="line">  ; 递归出口,回上一层递归</span><br><span class="line">  400ff9:	7d 0c                	jge    401007 &lt;func4+0x39&gt;</span><br><span class="line">  400ffb:	8d 71 01             	lea    0x1(%rcx),%esi</span><br><span class="line">  400ffe:	e8 cb ff ff ff       	callq  400fce &lt;func4&gt;</span><br><span class="line">  401003:	8d 44 00 01          	lea    0x1(%rax,%rax,1),%eax</span><br><span class="line">  ; 返回</span><br><span class="line">  401007:	48 83 c4 08          	add    $0x8,%rsp</span><br><span class="line">  40100b:	c3                   	retq  </span><br></pre></td></tr></table></div></figure>
<p>尝试将func4由汇编翻译回<code>C</code>代码，</p>
<figure class="highlight c"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">func4</span><span class="params">(<span class="keyword">int</span> edi, <span class="keyword">int</span> esi, <span class="keyword">int</span> edx)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp = (edx - esi);</span><br><span class="line">    <span class="keyword">int</span> ecx=(temp&gt;&gt;<span class="number">31</span>)&amp;(<span class="number">0x0001</span>);</span><br><span class="line">    temp+=ecx;</span><br><span class="line">    temp=temp&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = temp + esi;</span><br><span class="line">    <span class="keyword">if</span> (mid &gt; edi) &#123;</span><br><span class="line">        edx = mid - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> ret1 = func4(edi, esi, edx);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * ret1;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (mid &gt;= edi) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            esi = mid + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">int</span> ret2 = func4(edi, esi, edx);</span><br><span class="line">            <span class="keyword">return</span> (<span class="number">2</span> * ret2 + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> edi = <span class="number">0</span>; edi &lt; <span class="number">10</span>; edi++) &#123;</span><br><span class="line">        <span class="keyword">int</span> res = func4(edi, <span class="number">0</span>, <span class="number">14</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;edi=%d, res=%d\n&quot;</span>, edi, res);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; gcc -o <span class="built_in">test</span> .\bombPhase4.c</span><br><span class="line">&gt; .\test.exe</span><br><span class="line">edi=0, res=0</span><br><span class="line">edi=1, res=0</span><br><span class="line">edi=2, res=4</span><br><span class="line">edi=3, res=0</span><br><span class="line">edi=4, res=2</span><br><span class="line">edi=5, res=2</span><br><span class="line">edi=6, res=6</span><br><span class="line">edi=7, res=0</span><br><span class="line">edi=8, res=1</span><br><span class="line">edi=9, res=1</span><br></pre></td></tr></table></div></figure>
<p>因此，<strong>7 0、3 0 、1 0</strong>等均可</p>

        <h4 id="第五个炸弹"   >
          <a href="#第五个炸弹" class="heading-link"><i class="fas fa-link"></i></a>第五个炸弹</h4>
      
<p>查看<code>phase_5</code>代码</p>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">0000000000401062 &lt;phase_5&gt;:</span><br><span class="line">  401062:	53                   	push   %rbx ; rbx入栈,本函数要使用rbx</span><br><span class="line">  401063:	48 83 ec 20          	sub    $0x20,%rsp ; 申请0x20&#x3D;32字节大小的栈帧</span><br><span class="line">  ;|   phase_5 ret addr   |</span><br><span class="line">  ;|        %rbx          |</span><br><span class="line">  ;|                      |</span><br><span class="line">  ;|                      |</span><br><span class="line">  ;|                      |</span><br><span class="line">  ;|                      | &lt;-rsp</span><br><span class="line">  </span><br><span class="line">  401067:	48 89 fb             	mov    %rdi,%rbx	; rbx&#x3D;rdi (rdi&#x3D;&amp;输入字符串,可由read_line分析得到) </span><br><span class="line">  ; 反汇编的at&amp;t风格代码</span><br><span class="line">  40106a:	64 48 8b 04 25 28 00 	mov    %fs:0x28,%rax ;把fs选择子的偏移值0x28(64bit)放入rax(64bit暂存器)</span><br><span class="line">														 </span><br><span class="line">  401071:	00 00 </span><br><span class="line">  401073:	48 89 44 24 18       	mov    %rax,0x18(%rsp)</span><br><span class="line">  ;|   phase_5 ret addr   |</span><br><span class="line">  ;|        %rbx          |</span><br><span class="line">  ;|        %rax          |</span><br><span class="line">  ;|                      |</span><br><span class="line">  ;|                      |</span><br><span class="line">  ;|                      | &lt;-rsp</span><br><span class="line">  </span><br><span class="line">  401078:	31 c0                	xor    %eax,%eax ; eax清零</span><br><span class="line">  40107a:	e8 9c 02 00 00       	callq  40131b &lt;string_length&gt; ; 猜测是获取字符串长度返回eax</span><br><span class="line">  40107f:	83 f8 06             	cmp    $0x6,%eax ; 判断输入字符串长度是否是6</span><br><span class="line">  ; 如果长度是6,跳转L2 清零eax(rax低32位,这里可视为rax)</span><br><span class="line">  401082:	74 4e                	je     4010d2 &lt;phase_5+0x70&gt;</span><br><span class="line">  ; 长度不是6,引爆炸弹</span><br><span class="line">  401084:	e8 b1 03 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  401089:	eb 47                	jmp    4010d2 &lt;phase_5+0x70&gt;</span><br><span class="line">  ; L1 跳回 循环点   初次从L2跳来, eax为零</span><br><span class="line">  ; 这里是根据输入的6字节字符串低4位为序号从另一个字符串中取字符存到栈的rsp+0x10为最低地址处</span><br><span class="line">  40108b:	0f b6 0c 03          	movzbl (%rbx,%rax,1),%ecx ; ecx&#x3D; rbx(&amp;输入字符串)+rax(当前匹配的字符序号)</span><br><span class="line">  40108f:	88 0c 24             	mov    %cl,(%rsp) ; 在栈顶存储%cl (rcx最低字节)</span><br><span class="line">  401092:	48 8b 14 24          	mov    (%rsp),%rdx 	; rdx&#x3D;%cl</span><br><span class="line">  401096:	83 e2 0f             	and    $0xf,%edx 	; edx高位清零,只留下最低4位</span><br><span class="line">  401099:	0f b6 92 b0 24 40 00 	movzbl 0x4024b0(%rdx), %edx ; edx&#x3D; M[0x4024b0+%rdx]零扩展字节至双字</span><br><span class="line">  4010a0:	88 54 04 10          	mov    %dl,0x10(%rsp,%rax,1); M[rsp+rax+0x10]处存入%dl(%edx低字节)</span><br><span class="line">  4010a4:	48 83 c0 01          	add    $0x1,%rax	; rax++ , rax存放的应该是当前匹配的字符序号</span><br><span class="line">  4010a8:	48 83 f8 06          	cmp    $0x6,%rax	; 比较取完没</span><br><span class="line">  4010ac:	75 dd                	jne    40108b &lt;phase_5+0x29&gt; ; 没有取完全部6个,返回L1循环</span><br><span class="line">  </span><br><span class="line">  ; rsp+0x10---rsp+0x15 存储的取出的新6字节字符串 , 将 rsp+0x16清零,即字符串末尾标志&#39;\0&#39;</span><br><span class="line">  4010ae:	c6 44 24 16 00       	movb   $0x0,0x16(%rsp)</span><br><span class="line">  ; esi 存储 要和比较的字符串基址</span><br><span class="line">  4010b3:	be 5e 24 40 00       	mov    $0x40245e,%esi</span><br><span class="line">  ; rdi 存储 rsp+0x10,即新字符串的地址</span><br><span class="line">  4010b8:	48 8d 7c 24 10       	lea    0x10(%rsp),%rdi</span><br><span class="line">  ;进行比较;</span><br><span class="line">  ;由之前分析strings_not_equal函数使用edi和esi中的值当做两个字符址，并且判断他们是否相等，相等返回0</span><br><span class="line">  4010bd:	e8 76 02 00 00       	callq  401338 &lt;strings_not_equal&gt;</span><br><span class="line">  ; 判断返回值是否是0</span><br><span class="line">  4010c2:	85 c0                	test   %eax,%eax</span><br><span class="line">  ; 为零说明完全匹配成功,跳到L3退出</span><br><span class="line">  4010c4:	74 13                	je     4010d9 &lt;phase_5+0x77&gt;</span><br><span class="line">  ; 不为零说明无法完全匹配,爆炸</span><br><span class="line">  4010c6:	e8 6f 03 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  4010cb:	0f 1f 44 00 00       	nopl   0x0(%rax,%rax,1)</span><br><span class="line">  4010d0:	eb 07                	jmp    4010d9 &lt;phase_5+0x77&gt;</span><br><span class="line">  ;L2 eax清零后跳回L1</span><br><span class="line">  4010d2:	b8 00 00 00 00       	mov    $0x0,%eax </span><br><span class="line">  4010d7:	eb b2                	jmp    40108b &lt;phase_5+0x29&gt;</span><br><span class="line">  ;L3:</span><br><span class="line">  4010d9:	48 8b 44 24 18       	mov    0x18(%rsp),%rax</span><br><span class="line">  4010de:	64 48 33 04 25 28 00 	xor    %fs:0x28,%rax</span><br><span class="line">  4010e5:	00 00 </span><br><span class="line">  4010e7:	74 05                	je     4010ee &lt;phase_5+0x8c&gt;</span><br><span class="line">  4010e9:	e8 42 fa ff ff       	callq  400b30 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">  4010ee:	48 83 c4 20          	add    $0x20,%rsp</span><br><span class="line">  4010f2:	5b                   	pop    %rbx</span><br><span class="line">  4010f3:	c3                   	retq   </span><br></pre></td></tr></table></div></figure>
<ol>
<li>要求输入6个字符，然后依次循环这个输入的字符数组</li>
<li>每一轮循环取一个字符，然后取这个字符的后四位作为索引，在第二个字符常量<code>0x4024b0</code>处取一个字符依次存放到<code>%rsp+0x10+i</code>处</li>
</ol>
 <figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">print</span> (char*)0x4024b0</span><br><span class="line"><span class="variable">$1</span> = 0x4024b0 &lt;array&gt; <span class="string">&quot;maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?&quot;</span></span><br></pre></td></tr></table></div></figure>
<p>​	3. 将新<code>0x10(%rsp)</code>处的字符串和<code>0x40245e</code>处的字符串比较，相同则通过，否则爆炸</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">print</span> (char*)0x40245e</span><br><span class="line"><span class="variable">$2</span> = 0x40245e <span class="string">&quot;flyers&quot;</span></span><br></pre></td></tr></table></div></figure>
<p>由于低4位只能表示0-15,因此只能从<code>&lt;array&gt;: maduiersnfotvbyl</code>取得</p>
<p><code>f :array[9] 1001=9</code>，查找<code>ASCII</code>表低位为9的字符:<code>)9IYiy</code></p>
<p><code>l :array[15] 1111</code>=F, <code>/?O_0</code><br />
<code>y :array[14] 1110=E</code> , <code>.&gt;N^n~</code></p>
<p><code>e :array[5] 5</code>,<code>%5EUeu</code></p>
<p><code>r :array[6] 6</code>, <code>&amp;6FVfv</code></p>
<p><code>s :array[7] 7</code>, <code>,7GWgw</code></p>
<p>答案多种，如**<code>YONEFw</code> 、<code>y?nevw</code>**</p>
<p><code>string_length</code>代码</p>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">000000000040131b &lt;string_length&gt;:</span><br><span class="line">  40131b:	80 3f 00             	cmpb   $0x0,(%rdi)</span><br><span class="line">  40131e:	74 12                	je     401332 &lt;string_length+0x17&gt;</span><br><span class="line">  401320:	48 89 fa             	mov    %rdi,%rdx</span><br><span class="line">  401323:	48 83 c2 01          	add    $0x1,%rdx</span><br><span class="line">  401327:	89 d0                	mov    %edx,%eax</span><br><span class="line">  401329:	29 f8                	sub    %edi,%eax</span><br><span class="line">  40132b:	80 3a 00             	cmpb   $0x0,(%rdx)</span><br><span class="line">  40132e:	75 f3                	jne    401323 &lt;string_length+0x8&gt;</span><br><span class="line">  401330:	f3 c3                	repz retq </span><br><span class="line">  401332:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  401337:	c3                   	retq   </span><br></pre></td></tr></table></div></figure>
<p>结合<code>read_line</code>，应该是获取<code>rdi</code>为地址的字符串的长度返回给<code>eax(rax)</code></p>

        <h4 id="第六个炸弹"   >
          <a href="#第六个炸弹" class="heading-link"><i class="fas fa-link"></i></a>第六个炸弹</h4>
      
<p>查看<code>phase_6</code>代码</p>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line">00000000004010f4 &lt;phase_6&gt;:</span><br><span class="line">  4010f4:	41 56                	push   %r14</span><br><span class="line">  4010f6:	41 55                	push   %r13</span><br><span class="line">  4010f8:	41 54                	push   %r12</span><br><span class="line">  4010fa:	55                   	push   %rbp</span><br><span class="line">  4010fb:	53                   	push   %rbx ; 寄存器入栈,将要被本函数调用</span><br><span class="line">  </span><br><span class="line">  4010fc:	48 83 ec 50          	sub    $0x50,%rsp; 申请80字节的栈帧</span><br><span class="line">  ;|  phase_6 ret addr  |</span><br><span class="line">  ;|                    |</span><br><span class="line">  ;|                    |</span><br><span class="line">  ;|                    |</span><br><span class="line">  ;|                    |</span><br><span class="line">  ;|                    |</span><br><span class="line">  ;|                    |</span><br><span class="line">  ;|                    |</span><br><span class="line">  ;|                    |</span><br><span class="line">  ;|                    |</span><br><span class="line">  ;|                    | &lt;- rsp &lt;- r13 &lt;- rsi</span><br><span class="line">  401100:	49 89 e5             	mov    %rsp,%r13</span><br><span class="line">  401103:	48 89 e6             	mov    %rsp,%rsi</span><br><span class="line">  </span><br><span class="line">  ;调用读取6数字函数,内部调用了sscanf</span><br><span class="line">  ;sscanf参数顺序分别是，</span><br><span class="line">  ;待读取内容的字符串(rdi)、</span><br><span class="line">  ;用于格式读取的格式化字符串(rsi)，</span><br><span class="line">  ;还有各个变量读取后存放的地址(rdx)。</span><br><span class="line">  ; &lt;read_six_numbers&gt;中,%rdx由 %rsi 给出，%rsi 在 phrase6中 又由 %rsp 给出</span><br><span class="line">  ; 因此输入的数字存到phase_6的%rsp处</span><br><span class="line">  ;返回读到的有效数据个数</span><br><span class="line">  401106:	e8 51 03 00 00       	callq  40145c &lt;read_six_numbers&gt;</span><br><span class="line">  ;读入了 6 个数字，分别放入了 %rsp+0x0、%rsp+0x4、%rsp+0x8、%rsp+0xc、%rsp+0x10、%rsp+0x14</span><br><span class="line">  40110b:	49 89 e6             	mov    %rsp,%r14 </span><br><span class="line">  ; 先将r12(d低32位)置零</span><br><span class="line">  ; r12 用于计数L4循环</span><br><span class="line">  40110e:	41 bc 00 00 00 00    	mov    $0x0,%r12d</span><br><span class="line">  ;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  ;L4</span><br><span class="line">  401114:	4c 89 ed             	mov    %r13,%rbp</span><br><span class="line">  ; 初始情况</span><br><span class="line">  ;|  phase_6 ret addr  |</span><br><span class="line">  ;|                    |</span><br><span class="line">  ;|                    |</span><br><span class="line">  ;|                    |</span><br><span class="line">  ;|                    |</span><br><span class="line">  ;|                    |</span><br><span class="line">  ;|                    |</span><br><span class="line">  ;|                    |</span><br><span class="line">  ;|  num6     num5     |</span><br><span class="line">  ;|  num4     num3     |</span><br><span class="line">  ;|  num2     num1     | &lt;- rsp r13 r14 rbp rsi</span><br><span class="line">  </span><br><span class="line">  ; eax赋值为r13指向的内存数据</span><br><span class="line">  401117:	41 8b 45 00          	mov    0x0(%r13),%eax</span><br><span class="line">  ; eax&#x3D;eax-1</span><br><span class="line">  40111b:	83 e8 01             	sub    $0x1,%eax</span><br><span class="line">  ; 将eax与 5比较</span><br><span class="line">  40111e:	83 f8 05             	cmp    $0x5,%eax</span><br><span class="line">  ; eax无符号&lt;&#x3D;5,跳过起爆函数至L1,否则爆炸,即原数据&lt;&#x3D;6</span><br><span class="line">  401121:	76 05                	jbe    401128 &lt;phase_6+0x34&gt;</span><br><span class="line">  401123:	e8 12 03 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  ;L1: %r12d(r12低32位)++</span><br><span class="line">  401128:	41 83 c4 01          	add    $0x1,%r12d</span><br><span class="line">  ; 将r12d与6做比较</span><br><span class="line">  40112c:	41 83 fc 06          	cmp    $0x6,%r12d</span><br><span class="line">  ; r12&#x3D;6则跳转至L2</span><br><span class="line">  401130:	74 21                	je     401153 &lt;phase_6+0x5f&gt;</span><br><span class="line">  ; 否则 ebx&#x3D;r12d </span><br><span class="line">  401132:	44 89 e3             	mov    %r12d,%ebx</span><br><span class="line">  ;L3: rax&#x3D; ebx符号扩展4字 假设r12d&#x3D;i</span><br><span class="line">  401135:	48 63 c3             	movslq %ebx,%rax</span><br><span class="line">  ; rax&#x3D; M[rsp+4*rax]  假设r12d&#x3D;i , 则rax&#x3D;num(i)</span><br><span class="line">  401138:	8b 04 84             	mov    (%rsp,%rax,4),%eax</span><br><span class="line">  ; eax(rax)&#x3D; num(i+1)与 M[rbp]&#x3D;M[r13]&#x3D;num(i)进行比较</span><br><span class="line">  40113b:	39 45 00             	cmp    %eax,0x0(%rbp)</span><br><span class="line">  ;不相等跳过爆炸函数</span><br><span class="line">  40113e:	75 05                	jne    401145 &lt;phase_6+0x51&gt;</span><br><span class="line">  ; 相等起爆</span><br><span class="line">  401140:	e8 f5 02 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  ; 跳过起爆函数 ebx++</span><br><span class="line">  401145:	83 c3 01             	add    $0x1,%ebx</span><br><span class="line">  ; 比较ebx和5</span><br><span class="line">  401148:	83 fb 05             	cmp    $0x5,%ebx</span><br><span class="line">  ; ebx&lt;&#x3D;5 跳转回L3,下一个num</span><br><span class="line">  40114b:	7e e8                	jle    401135 &lt;phase_6+0x41&gt;</span><br><span class="line">  ; ebx&gt;&#x3D;6, r13+&#x3D;4</span><br><span class="line">  40114d:	49 83 c5 04          	add    $0x4,%r13</span><br><span class="line">  ; 跳回L4,将 r13 rbp等寄存器调整为指向栈中下一个num</span><br><span class="line">  401151:	eb c1                	jmp    401114 &lt;phase_6+0x20&gt;</span><br><span class="line">  ;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  ;上述代码的作用是,确保输入的6个数字均&lt;&#x3D;6，并且num(i)不和num(i+1)~num(6)相同 </span><br><span class="line">  ; 1&lt;&#x3D;i&lt;&#x3D;5</span><br><span class="line">  ;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  ;L2: r12&#x3D;6跳转点;跳出上面的检查循环</span><br><span class="line">  401153:	48 8d 74 24 18       	lea    0x18(%rsp),%rsi</span><br><span class="line">  401158:	4c 89 f0             	mov    %r14,%rax</span><br><span class="line">  ;|  phase_6 ret addr  |</span><br><span class="line">  ;|                    |</span><br><span class="line">  ;|                    |</span><br><span class="line">  ;|                    |</span><br><span class="line">  ;|                    |</span><br><span class="line">  ;|                    |</span><br><span class="line">  ;|                    |</span><br><span class="line">  ;|                    | &lt;- rsi</span><br><span class="line">  ;|  num6     num5     |</span><br><span class="line">  ;|  num4     num3     |</span><br><span class="line">  ;|  num2     num1     | &lt;- rsp r14 rax</span><br><span class="line">  </span><br><span class="line">  40115b:	b9 07 00 00 00       	mov    $0x7,%ecx</span><br><span class="line">  ;L5: 循环,  num[i]&#x3D;7-num[i] 6个输入数字全部对7求补</span><br><span class="line">  401160:	89 ca                	mov    %ecx,%edx</span><br><span class="line">  ; rcx&#x3D;7, rdx&#x3D;7</span><br><span class="line">  401162:	2b 10                	sub    (%rax),%edx; edx&#x3D;7-num(rax point)</span><br><span class="line">  ; num(rax point)&#x3D; edx&#x3D;7-num(rax point) </span><br><span class="line">  401164:	89 10                	mov    %edx,(%rax)</span><br><span class="line">  ; rax+&#x3D;4指向下一个num</span><br><span class="line">  401166:	48 83 c0 04          	add    $0x4,%rax</span><br><span class="line">  ; 判断 rax指完所有num没有</span><br><span class="line">  40116a:	48 39 f0             	cmp    %rsi,%rax</span><br><span class="line">  ; 没指完，跳转L5继续指</span><br><span class="line">  40116d:	75 f1                	jne    401160 &lt;phase_6+0x6c&gt;</span><br><span class="line">  </span><br><span class="line">  ;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  ; esi清零</span><br><span class="line">  40116f:	be 00 00 00 00       	mov    $0x0,%esi</span><br><span class="line">  ; 无条件跳转至L6</span><br><span class="line">  401174:	eb 21                	jmp    401197 &lt;phase_6+0xa3&gt;</span><br><span class="line">  ; L7: L6处理完后跳回点</span><br><span class="line">  401176:	48 8b 52 08          	mov    0x8(%rdx),%rdx ; rdx&#x3D; M[rdx+8]; 而edx赋了个地址,数据大小是8字节</span><br><span class="line">  40117a:	83 c0 01             	add    $0x1,%eax ; eax+&#x3D;1</span><br><span class="line">  40117d:	39 c8                	cmp    %ecx,%eax ; 将eax和ecx比较</span><br><span class="line">  ; eax ecx不相等跳回L7</span><br><span class="line">  40117f:	75 f5                	jne    401176 &lt;phase_6+0x82&gt;</span><br><span class="line">  ; eax ecx相等跳到L9</span><br><span class="line">  401181:	eb 05                	jmp    401188 &lt;phase_6+0x94&gt;</span><br><span class="line">  ;L8 : L6中ecx&lt;&#x3D;1跳回点</span><br><span class="line">  401183:	ba d0 32 60 00       	mov    $0x6032d0,%edx; 同样也把edx赋地址值0x6032d0</span><br><span class="line">  ;L9 把rdx存储的数据(即从0x6032d0+OFFSET)处获取的数据存入栈中 M[rsp+0x20++2*rsi]</span><br><span class="line">  401188:	48 89 54 74 20       	mov    %rdx,0x20(%rsp,%rsi,2)</span><br><span class="line">  40118d:	48 83 c6 04          	add    $0x4,%rsi; rsi+&#x3D;4</span><br><span class="line">  401191:	48 83 fe 18          	cmp    $0x18,%rsi; 判断rsi是否等于0x18&#x3D;24,即循环6次了</span><br><span class="line">  ; 循环6次,栈rsp+0x20+OFFSET存入6个8字节数据了,跳到L10</span><br><span class="line">  401195:	74 14                	je     4011ab &lt;phase_6+0xb7&gt;</span><br><span class="line">  ;L6</span><br><span class="line">  ; ecx&#x3D; M[rsp+rsi] ; 注意40116f把esi清零 ecx&#x3D;M[rsp+rsi]&#x3D;num(1...6)</span><br><span class="line">  401197:	8b 0c 34             	mov    (%rsp,%rsi,1),%ecx</span><br><span class="line">  ; 将ecx(num1)与1比较</span><br><span class="line">  40119a:	83 f9 01             	cmp    $0x1,%ecx</span><br><span class="line">  ; ecx(num1)有符号&lt;&#x3D; 1跳回L8</span><br><span class="line">  40119d:	7e e4                	jle    401183 &lt;phase_6+0x8f&gt;</span><br><span class="line">  ; eax&#x3D;1</span><br><span class="line">  40119f:	b8 01 00 00 00       	mov    $0x1,%eax</span><br><span class="line">  ; edx&#x3D;0x6032d0,是一个地址</span><br><span class="line">  4011a4:	ba d0 32 60 00       	mov    $0x6032d0,%edx</span><br><span class="line">  ; 跳回L7</span><br><span class="line">  4011a9:	eb cb                	jmp    401176 &lt;phase_6+0x82&gt;</span><br><span class="line">  ;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  ;作用是访问一个链表，链表的首地址为 0x6032d0，针对输入的第 i 个数，</span><br><span class="line">  ;按照 num[i] 的值获取链表第 num[i] 个节点，</span><br><span class="line">  ;并把节点首地址放入 %rsp+0x20+0x0~%rsp+0x20+0x28 刚好是 6 个节点。</span><br><span class="line">  ;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">  </span><br><span class="line">  ;L10:  </span><br><span class="line">  4011ab:	48 8b 5c 24 20       	mov    0x20(%rsp),%rbx</span><br><span class="line">  4011b0:	48 8d 44 24 28       	lea    0x28(%rsp),%rax</span><br><span class="line">  4011b5:	48 8d 74 24 50       	lea    0x50(%rsp),%rsi</span><br><span class="line">  4011ba:	48 89 d9             	mov    %rbx,%rcx</span><br><span class="line">  4011bd:	48 8b 10             	mov    (%rax),%rdx</span><br><span class="line">  4011c0:	48 89 51 08          	mov    %rdx,0x8(%rcx)</span><br><span class="line">  4011c4:	48 83 c0 08          	add    $0x8,%rax</span><br><span class="line">  4011c8:	48 39 f0             	cmp    %rsi,%rax</span><br><span class="line">  4011cb:	74 05                	je     4011d2 &lt;phase_6+0xde&gt;</span><br><span class="line">  4011cd:	48 89 d1             	mov    %rdx,%rcx</span><br><span class="line">  4011d0:	eb eb                	jmp    4011bd &lt;phase_6+0xc9&gt;</span><br><span class="line">  4011d2:	48 c7 42 08 00 00 00 	movq   $0x0,0x8(%rdx)</span><br><span class="line">  4011d9:	00 </span><br><span class="line">  4011da:	bd 05 00 00 00       	mov    $0x5,%ebp</span><br><span class="line">  </span><br><span class="line">  ;%rsp+0x20+0x0~ %rsp+0x20+0x28 存储的链表节点地址指向的数值必须是递减的。低地址存的数据要更大</span><br><span class="line">  ; rax&#x3D; M[rbx+8]</span><br><span class="line">  4011df:	48 8b 43 08          	mov    0x8(%rbx),%rax</span><br><span class="line">  ; eax&#x3D; M[rax]</span><br><span class="line">  4011e3:	8b 00                	mov    (%rax),%eax</span><br><span class="line">  ; 比较M[rax]&#x3D;M[rbx+8]和M[rbx], 32位数据</span><br><span class="line">  4011e5:	39 03                	cmp    %eax,(%rbx)</span><br><span class="line">  ;若不爆炸需要M[rbx]&gt;&#x3D;M[rbx+8]</span><br><span class="line">  4011e7:	7d 05                	jge    4011ee &lt;phase_6+0xfa&gt;</span><br><span class="line">  4011e9:	e8 4c 02 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  4011ee:	48 8b 5b 08          	mov    0x8(%rbx),%rbx</span><br><span class="line">  4011f2:	83 ed 01             	sub    $0x1,%ebp</span><br><span class="line">  4011f5:	75 e8                	jne    4011df &lt;phase_6+0xeb&gt;</span><br><span class="line">  4011f7:	48 83 c4 50          	add    $0x50,%rsp</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  4011fb:	5b                   	pop    %rbx</span><br><span class="line">  4011fc:	5d                   	pop    %rbp</span><br><span class="line">  4011fd:	41 5c                	pop    %r12</span><br><span class="line">  4011ff:	41 5d                	pop    %r13</span><br><span class="line">  401201:	41 5e                	pop    %r14</span><br><span class="line">  401203:	c3                   	retq   </span><br></pre></td></tr></table></div></figure>
<p>用<code>gdb</code>查看<code>0x6032d0</code>开始的数据,根据<code>401176</code>以8字节为单位查看</p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x /6gx 0x6032d0</span><br><span class="line">0x6032d0 &lt;node1&gt;:	0x00000001 0000014c	  0x00000000 006032e0</span><br><span class="line">0x6032e0 &lt;node2&gt;:	0x00000002 000000a8	  0x00000000 006032f0</span><br><span class="line">0x6032f0 &lt;node3&gt;:	0x00000003 0000039c	  0x00000000 00603300</span><br></pre></td></tr></table></div></figure>
<p>访问一个链表，链表的首地址为 <code>0x6032d0</code>，针对输入的第 <code>i</code> 个数，按照 <code>a[i]</code> 的值获取链表第 <code>a[i]</code> 个节点，并把节点首地址放入 <code>%rsp+0x20+0x0</code>~ 到 <code>%rsp+0x20+0x28</code> 刚好是 6 个节点。</p>
<div class="table-container"><table>
<thead>
<tr>
<th>地址</th>
<th>数据</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x6032d0</td>
<td>0x0000014c</td>
</tr>
<tr>
<td>0x6032d4</td>
<td>0x00000001</td>
</tr>
<tr>
<td>0x6032d8</td>
<td>0x006032e0</td>
</tr>
<tr>
<td>0x6032dc</td>
<td>0x00000000</td>
</tr>
<tr>
<td>0x6032e0</td>
<td>0x000000a8</td>
</tr>
<tr>
<td>0x6032e4</td>
<td>0x00000002</td>
</tr>
<tr>
<td>0x6032e8</td>
<td>0x006032f0</td>
</tr>
<tr>
<td>0x6032ec</td>
<td>0x00000000</td>
</tr>
<tr>
<td>0x6032f0</td>
<td>0x0000039c</td>
</tr>
</tbody>
</table></div>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x /wx 0x6032d0</span><br><span class="line">0x6032d0 &lt;node1&gt;:	0x0000014c <span class="comment"># 链表结点1 data的低32位,由于输入的数据是int 32位，可以先不看高32位data 5</span></span><br><span class="line">(gdb) x /wx 0x6032d0+8</span><br><span class="line">0x6032d8 &lt;node1+8&gt;:	0x006032e0 <span class="comment"># 结点1存储的结点2的地址</span></span><br><span class="line"></span><br><span class="line">(gdb) x /wx 0x6032e0</span><br><span class="line">0x6032e0 &lt;node2&gt;:	0x000000a8 <span class="comment"># data 6</span></span><br><span class="line">(gdb) x /wx 0x6032e0+8</span><br><span class="line">0x6032e8 &lt;node2+8&gt;:	0x006032f0 <span class="comment"># addr</span></span><br><span class="line"></span><br><span class="line">(gdb) x /wx 0x6032f0</span><br><span class="line">0x6032f0 &lt;node3&gt;:	0x0000039c <span class="comment"># data 1</span></span><br><span class="line">(gdb) x /wx 0x6032f0+8</span><br><span class="line">0x6032f8 &lt;node3+8&gt;:	0x00603300 <span class="comment"># addr</span></span><br><span class="line"></span><br><span class="line">(gdb) x /wx 0x603300</span><br><span class="line">0x603300 &lt;node4&gt;:	0x000002b3 <span class="comment">#data 2</span></span><br><span class="line">(gdb) x /wx 0x603300+8</span><br><span class="line">0x603308 &lt;node4+8&gt;:	0x00603310 <span class="comment"># addr</span></span><br><span class="line"></span><br><span class="line">(gdb) x /wx 0x603310</span><br><span class="line">0x603310 &lt;node5&gt;:	0x000001dd <span class="comment">#data 3</span></span><br><span class="line">(gdb) x /wx 0x603310+8</span><br><span class="line">0x603318 &lt;node5+8&gt;:	0x00603320 <span class="comment"># addr</span></span><br><span class="line"></span><br><span class="line">(gdb) x /wx 0x603320</span><br><span class="line">0x603320 &lt;node6&gt;:	0x000001bb <span class="comment">#data 4</span></span><br><span class="line">(gdb) x /wx 0x603320+8</span><br><span class="line">0x603328 &lt;node6+8&gt;:	0x00000000</span><br></pre></td></tr></table></div></figure>
<p>一共6个结点，第一个结点地址数据存在<code>%rsp+0x20+0x0</code>处，这个地址数据指向的结点data应该最大，由于比较<code>cmp</code>的是32位数据，只需要注意地址指向数据的低32位。</p>
<p>最大的数据是<code>0x0000039c</code>，是第3个结点， 此时的num1=3，</p>
<p>第2大的数据是<code>0x000002b3</code> ，第4个结点 num2=4</p>
<p>第3大的数据是<code>0x000001dd</code> ，第5个结点 num3=5</p>
<p>第4大的数据是<code>0x000001bb</code> ，第6个结点 num4=6</p>
<p>第5大的数据是<code>0x0000014c</code> ，第1个结点 num5=1</p>
<p>第6大的数据是<code>0x000000a8</code> ，第2个结点 num3=2</p>
<p><code>num=[3,4,5,6,1,2]</code></p>
<p>但是注意这是把输入的<code>num</code>进行了<code>num=7-num</code></p>
<p>所以输入是</p>
<p><code>num=[4,3,2,1,6,5]</code></p>
<p>最终答案是**4 3 2 1 6 5 **</p>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ 本文结束，感谢您的阅读 ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">本文作者: </span><span class="copyright-author__value"><a href="https://www.neptunia.top">Aaron</a></span></div><div class="copyright-link"><span class="copyright-link__name">本文链接: </span><span class="copyright-link__value"><a href="https://www.neptunia.top/2022/11/05/bomblabProcedure/">https://www.neptunia.top/2022/11/05/bomblabProcedure/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">版权声明: </span><span class="copyright-notice__value">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> 许可协议。转载请注明出处！</span></div></div><div class="post-tags"><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="https://www.neptunia.top/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/">计算机组成原理</a></span></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2022/11/05/80X86-chapter3-Memory/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">微机原理-第三章-内存储器习题</span></a></div></nav></footer></div></div><div class="comments" id="comments"><div id="gitalk-container"></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">文章目录</span><span class="sidebar-nav-ov">站点概览</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#bomb-lab-procedure"><span class="toc-number">1.</span> <span class="toc-text">
          Bomb Lab Procedure</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">1.0.1.</span> <span class="toc-text">
          准备工作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E4%BB%A3%E7%A0%81"><span class="toc-number">1.0.2.</span> <span class="toc-text">
          查看代码</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#c-%E4%BB%A3%E7%A0%81"><span class="toc-number">1.0.2.1.</span> <span class="toc-text">
          C 代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%8D%E6%B1%87%E7%BC%96%E4%BB%A3%E7%A0%81"><span class="toc-number">1.0.2.2.</span> <span class="toc-text">
          反汇编代码</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E7%82%B8%E5%BC%B9"><span class="toc-number">1.0.3.</span> <span class="toc-text">
          第一个炸弹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E4%B8%AA%E7%82%B8%E5%BC%B9"><span class="toc-number">1.0.4.</span> <span class="toc-text">
          第二个炸弹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E4%B8%AA%E7%82%B8%E5%BC%B9"><span class="toc-number">1.0.5.</span> <span class="toc-text">
          第三个炸弹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E4%B8%AA%E7%82%B8%E5%BC%B9"><span class="toc-number">1.0.6.</span> <span class="toc-text">
          第四个炸弹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E4%B8%AA%E7%82%B8%E5%BC%B9"><span class="toc-number">1.0.7.</span> <span class="toc-text">
          第五个炸弹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E4%B8%AA%E7%82%B8%E5%BC%B9"><span class="toc-number">1.0.8.</span> <span class="toc-text">
          第六个炸弹</span></a></li></ol></li></ol></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="https://s2.loli.net/2022/04/01/BD2WfjUMlS7FxTv.jpg" alt="avatar"></div><p class="sidebar-ov-author__text">Hello world!</p></div><div class="sidebar-ov-social"><a class="sidebar-ov-social-item" href="https://github.com/Waldenth" target="_blank" rel="noopener" data-popover="Github" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-github"></i></span></a><a class="sidebar-ov-social-item" href="mailto:waldenth@outlook.com" target="_blank" rel="noopener" data-popover="outlook-email" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fas fa-mail-bulk"></i></span></a><a class="sidebar-ov-social-item" href="https://space.bilibili.com/31914896" target="_blank" rel="noopener" data-popover="Bilibili" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fas fa-tv"></i></span></a><a class="sidebar-ov-social-item" href="https://steamcommunity.com/profiles/76561198873347160/" target="_blank" rel="noopener" data-popover="steam" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-steam"></i></span></a></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">20</div><div class="sidebar-ov-state-item__name">归档</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">12</div><div class="sidebar-ov-state-item__name">标签</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="知识共享许可协议" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">你已阅读了 </span><span class="sidebar-reading-info__num">0</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2023</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>Aaron</span><span class="footer__devider">|</span><span><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鄂ICP备2021008806号-1</a></span></div><div><span>由 <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> 强力驱动</span><span> v5.2.0</span><span class="footer__devider">|</span><span>主题 - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.1.1</span></div><div class="busuanzi"><span class="busuanzi-siteuv"><span class="busuanzi-siteuv__icon"><i class="fas fa-user"></i></span><span class="busuanzi-siteuv__info">访问人数</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_uv"></span></span><span class="busuanzi-sitepv"><span class="busuanzi-siteuv__icon"><i class="fas fa-eye"></i></span><span class="busuanzi-siteuv__info">浏览总量</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><div class="search-mask"></div><div class="search-popup"><span class="search-close"></span><div class="search-input"><input placeholder="搜索文章（支持多关键词，请用空格分隔）"></div><div class="search-results"></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script>function initSearch() {
  var isXML = true;
  var search_path = 'search.json';

  if (!search_path) {
    search_path = 'search.xml';
  } else if (/json$/i.test(search_path)) {
    isXML = false;
  }

  var path = '/' + search_path;
  $.ajax({
    url: path,
    dataType: isXML ? 'xml' : 'json',
    async: true,
    success: function (res) {
      var datas = isXML ? $('entry', res).map(function () {
        // 将 XML 转为 JSON
        return {
          title: $('title', this).text(),
          content: $('content', this).text(),
          url: $('url', this).text()
        };
      }).get() : res;
      var $input = $('.search-input input');
      var $result = $('.search-results');
      // 搜索对象（标题、内容）的权重，影响显示顺序
      var WEIGHT = { title: 100, content: 1 };
      var searchPost = function () {
        var searchText = $input.val().toLowerCase().trim();
        // 根据空白字符分隔关键字
        var keywords = searchText.split(/[\s]+/);
        // 搜索结果
        var matchPosts = [];

        // 有多个关键字时，将原文字整个保存下来
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        // 防止未输入字符时搜索
        if (searchText.length > 0) {
          datas.forEach(function (data) {
            var isMatch  = false;
            // 没有标题的文章使用预设的 i18n 变量代替
            var title = (data.title && data.title.trim()) || '[ 文章无标题 ]';
            var titleLower = title && title.toLowerCase();
            // 删除 HTML 标签 和 所有空白字符
            var content = data.content && data.content.replace(/<[^>]+>/g, '');
            var contentLower = content && content.toLowerCase();
            // 删除重复的 /
            var postURL = data.url && decodeURI(data.url).replace(/\/{2,}/g, '/');
            // 标题中匹配到的关键词
            var titleHitSlice = [];
            // 内容中匹配到的关键词
            var contentHitSlice = [];

            keywords.forEach(function (keyword) {
              /**
              * 获取匹配的关键词的索引
              * @param {String} keyword 要匹配的关键字
              * @param {String} text 原文字
              * @param {Boolean} caseSensitive 是否区分大小写
              * @param {Number} weight 匹配对象的权重。权重大的优先显示
              * @return {Array}
              */
              function getIndexByword (word, text, caseSensitive, weight) {
                if (!word || !text) {
                  return [];
                };

                var startIndex = 0; // 每次匹配的开始索引
                var index = -1;     // 匹配到的索引值
                var result = [];    // 匹配结果

                if (!caseSensitive) {
                  word = word.toLowerCase();
                  text = text.toLowerCase();
                }

                while((index = text.indexOf(word, startIndex)) !== -1) {
                  var hasMatch = false;
                  // 索引位置相同的关键词，保留长度较长的
                  titleHitSlice.forEach(function (hit) {
                    if (hit.index === index && hit.word.length < word.length) {
                      hit.word = word;
                      hasMatch = true;
                    }
                  });
                  startIndex = index + word.length;
                  !hasMatch && result.push({ index: index, word: word, weight: weight });
                }
                return result;
              }
              titleHitSlice = titleHitSlice.concat(getIndexByword(keyword, titleLower, false, WEIGHT.title));
              contentHitSlice = contentHitSlice.concat(getIndexByword(keyword, contentLower, false, WEIGHT.content));
            });

            var hitTitle = titleHitSlice.length;
            var hitContent = contentHitSlice.length;

            if (hitTitle > 0 || hitContent > 0) {
              isMatch = true;
            }
            if (isMatch) {
              ;[titleHitSlice, contentHitSlice].forEach(function (hit) {
                // 按照匹配文字的索引的递增顺序排序
                hit.sort(function (left, right) {
                  return left.index - right.index;
                });
              });
              /**
              * 给文本中匹配到的关键词添加标记，从而进行高亮显示
              * @param {String} text 原文本
              * @param {Array} hitSlice 匹配项的索引信息
              * @param {Number} start 开始索引
              * @param {Number} end 结束索引
              * @return {String}
              */
              function highlightKeyword (text, hitSlice, start, end) {
                if (!text || !hitSlice || !hitSlice.length) {
                  return;
                }

                var result = '';
                var startIndex = start;
                var endIndex = end;
                hitSlice.forEach(function (hit) {
                  if (hit.index < startIndex) {
                    return;
                  }

                  var hitWordEnd = hit.index + hit.word.length;
                  result += text.slice(startIndex, hit.index);
                  result += '<b>' + text.slice(hit.index, hitWordEnd) + '</b>';
                  startIndex = hitWordEnd;
                });
                result += text.slice(startIndex, endIndex);
                return result;
              }

              var postData = {};
              // 文章总的搜索权重
              var postWeight = titleHitSlice.length * WEIGHT.title + contentHitSlice.length * WEIGHT.content;
              // 标记匹配关键词后的标题
              var postTitle = highlightKeyword(title, titleHitSlice, 0, title.length) || title;
              // 标记匹配关键词后的内容
              var postContent;
              // 显示内容的长度
              var SHOW_WORD_LENGTH = 200;
              // 命中关键词前的字符显示长度
              var SHOW_WORD_FRONT_LENGTH = 20;
              var SHOW_WORD_END_LENGTH = SHOW_WORD_LENGTH - SHOW_WORD_FRONT_LENGTH;

              // 截取匹配的第一个字符，前后共 200 个字符来显示
              if (contentHitSlice.length > 0) {
                var firstIndex = contentHitSlice[0].index;
                var start = firstIndex > SHOW_WORD_FRONT_LENGTH ? firstIndex - SHOW_WORD_FRONT_LENGTH : 0;
                var end = firstIndex + SHOW_WORD_END_LENGTH;
                postContent = highlightKeyword(content, contentHitSlice, start, end);
              } else { // 未匹配到内容，直接截取前 200 个字符来显示
                postContent = content.slice(0, SHOW_WORD_LENGTH);
              }
              postData.title = postTitle;
              postData.content = postContent;
              postData.url = postURL;
              postData.weight = postWeight;
              matchPosts.push(postData);
            }
          });
        }

        var resultInnerHtml = '';
        if (matchPosts.length) {
          // 按权重递增的顺序排序，使权重大的优先显示
          matchPosts.sort(function (left, right) {
            return right.weight - left.weight;
          });
          resultInnerHtml += '<ul>';
          matchPosts.forEach(function (post) {
            resultInnerHtml += '<li><a class="search-results-title" href="' + post.url + '">';
            resultInnerHtml += post.title;
            resultInnerHtml += '</a><div class="search-results-content">';
            resultInnerHtml += post.content;
            resultInnerHtml += '</div></li>';
          });
          resultInnerHtml += '</ul>';
        } else {
          resultInnerHtml += '<div class="search-results-none"><i class="far fa-meh"></i></div>';
        }
        $result.html(resultInnerHtml);
      };
      $input.on('input', searchPost);
      $input.on('keyup', function (e) {
        if (e.keyCode === Stun.utils.codeToKeyCode('Enter')) {
          searchPost();
        }
      });
    }
  });
}

function closeSearch () {
  $('body').css({ overflow: 'auto' });
  $('.search-popup').css({ display: 'none' });
  $('.search-mask').css({ display: 'none' });
}

window.addEventListener('DOMContentLoaded', function () {
  Stun.utils.pjaxReloadLocalSearch = function () {
    $('.header-nav-search').on('click', function (e) {
      e.stopPropagation();
      $('body').css('overflow', 'hidden');
      $('.search-popup')
        .velocity('stop')
        .velocity('transition.expandIn', {
          duration: 300,
          complete: function () {
            $('.search-popup input').focus();
          }
        });
      $('.search-mask')
        .velocity('stop')
        .velocity('transition.fadeIn', {
          duration: 300
        });

      initSearch();
    });
    $('.search-mask, .search-close').on('click', function () {
      closeSearch();
    });
    $(document).on('keydown', function (e) {
      // Escape <=> 27
      if (e.keyCode === Stun.utils.codeToKeyCode('Escape')) {
        closeSearch();
      }
    });
  };

  Stun.utils.pjaxReloadLocalSearch();
}, false);</script><link href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" rel="stylesheet" type="text/css"><link href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/copy-tex.css" rel="stylesheet" type="text/css"><script src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/copy-tex.min.js"></script><script src="https://cdn.jsdelivr.net/gh/sukkaw/busuanzi@latest/bsz.pure.mini.js" async></script><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/js-md5@latest/src/md5.min.js"></script><script>function loadGitalk () {
  if (!document.getElementById('gitalk-container')) {
    return;
  }

  var gitalk = new Gitalk({
    id: md5(window.location.pathname.slice(1)),
    clientID: '3e452adc1e51ac23d97a',
    clientSecret: 'c2aa83661950454ec8b8efd85c75de2c65337624',
    repo: 'Waldenth.github.io',
    owner: 'Waldenth',
    admin: ['Waldenth'],
    distractionFreeMode: 'false',
    language: 'zh-CN'
  });
  gitalk.render('gitalk-container');
}

if (false) {
  loadGitalk();
} else {
  window.addEventListener('DOMContentLoaded', loadGitalk, false);
}</script><script src="/js/utils.js?v=2.1.1"></script><script src="/js/stun-boot.js?v=2.1.1"></script><script src="/js/scroll.js?v=2.1.1"></script><script src="/js/header.js?v=2.1.1"></script><script src="/js/sidebar.js?v=2.1.1"></script><script type="application/json" src="/search.json"></script></body></html>